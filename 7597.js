"use strict";(self.webpackChunkreveal_js_testing=self.webpackChunkreveal_js_testing||[]).push([[7597],{47597:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{eval('__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   "DictionaryLoader": () => (/* binding */ y)\n/* harmony export */ });\n/* harmony import */ var _Color_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(30936);\n/* harmony import */ var _request_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(66341);\n/* harmony import */ var _core_Error_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(70375);\n/* harmony import */ var _core_Logger_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(13802);\n/* harmony import */ var _core_LRUCache_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(55854);\n/* harmony import */ var _core_maybe_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(61681);\n/* harmony import */ var _core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(78668);\n/* harmony import */ var _core_string_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(21130);\n/* harmony import */ var _support_arcadeOnDemand_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(30879);\n/* harmony import */ var _symbols_CIMSymbol_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(62589);\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nconst f=_core_Logger_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"].getLogger */ .Z.getLogger("esri.renderers.support.DictionaryLoader"),h={type:"CIMSimpleLineCallout",lineSymbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",width:.5,color:[0,0,0,255]}]}};class y{constructor(e,t,s){this.config=null,this.fieldMap=null,this.url=null,this._ongoingRequests=new Map,this._symbolCache=new _core_LRUCache_js__WEBPACK_IMPORTED_MODULE_4__/* ["default"] */ .Z(100),this.url=e,this.config=t,this.fieldMap=s}getSymbolFields(){return this._symbolFields}async getSymbolAsync(t,s){let o;this._dictionaryPromise||(this._dictionaryPromise=this.fetchResources(s));try{o=await this._dictionaryPromise}catch(b){if((0,_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_5__/* .isAbortError */ .D_)(b))return this._dictionaryPromise=null,null}const i={};if(this.fieldMap)for(const e of this._symbolFields){const s=this.fieldMap[e];if(s&&null!=t.attributes[s]){const o=""+t.attributes[s];i[e]=o}else i[e]=""}const a=o(i,s);if(!a||"string"!=typeof a)return null;const c=(0,_core_string_js__WEBPACK_IMPORTED_MODULE_6__/* .numericHash */ .hP)(a).toString(),m=this._symbolCache.get(c);if(m)return m.catch((()=>{this._symbolCache.pop(c)})),m;const f=a.split(";"),h=[],y=[];for(const r of f)if(r)if(r.includes("po:")){const t=r.substr(3).split("|");if(3===t.length){const s=t[0],o=t[1];let i=t[2];if("DashTemplate"===o)i=i.split(" ").map((e=>Number(e)));else if("Color"===o){const t=new _Color_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .Z(i).toRgba();i=[t[0],t[1],t[2],255*t[3]]}else i=Number(i);y.push({primitiveName:s,propertyName:o,value:i})}}else if(r.includes("|")){for(const e of r.split("|"))if(this._itemNames.has(e)){h.push(e);break}}else this._itemNames.has(r)&&h.push(r);const u=!(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_9__/* .isSome */ .pC)(t.geometry)||!t.geometry.hasZ&&"point"===t.geometry.type,p=this._cimPartsToCIMSymbol(h,y,u,s);return this._symbolCache.put(c,p,1),p}async fetchResources(e){if(this._dictionaryPromise)return this._dictionaryPromise;if(!this.url)return void f.error("no valid URL!");const o=(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_9__/* .isSome */ .pC)(e)?e.abortOptions:null,i=(0,_request_js__WEBPACK_IMPORTED_MODULE_1__["default"])(this.url+"/resources/styles/dictionary-info.json",{responseType:"json",query:{f:"json"},...o}),[{data:n}]=await Promise.all([i,(0,_support_arcadeOnDemand_js__WEBPACK_IMPORTED_MODULE_7__/* .loadArcade */ .LC)()]);if(!n)throw this._dictionaryPromise=null,new _core_Error_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"] */ .Z("esri.renderers.DictionaryRenderer","Bad dictionary data!");const l=n.expression,m=n.authoringInfo;this._refSymbolUrlTemplate=this.url+"/"+n.cimRefTemplateUrl,this._itemNames=new Set(n.itemsNames),this._symbolFields=m.symbol;const h={};if(this.config){const e=this.config;for(const t in e)h[t]=e[t]}if(m.configuration)for(const t of m.configuration)h.hasOwnProperty(t.name)||(h[t.name]=t.value);const y=[];if((0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_9__/* .isSome */ .pC)(e)&&e.fields&&this.fieldMap)for(const t of this._symbolFields){const s=this.fieldMap[t],o=e.fields.filter((e=>e.name===s));o.length>0&&y.push({...o[0],name:t})}return this._dictionaryPromise=(0,_support_arcadeOnDemand_js__WEBPACK_IMPORTED_MODULE_7__/* .createDictionaryExpression */ .pp)(l,(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_9__/* .isSome */ .pC)(e)?e.spatialReference:null,y,h).then((e=>{const t={scale:0};return(s,o)=>{const i=e.repurposeFeature({geometry:null,attributes:s});return t.scale=(0,_core_maybe_js__WEBPACK_IMPORTED_MODULE_9__/* .isSome */ .pC)(o)?o.scale:void 0,e.evaluate({$feature:i,$view:t})}})).catch((e=>(f.error("Creating dictinoary expression failed:",e),null))),this._dictionaryPromise}async _cimPartsToCIMSymbol(e,t,s,o){const i=new Array(e.length);for(let l=0;l<e.length;l++)i[l]=this._getSymbolPart(e[l],o);const r=await Promise.all(i),n=this.fieldMap;for(const l of r)u(l,n);return new _symbols_CIMSymbol_js__WEBPACK_IMPORTED_MODULE_8__/* ["default"] */ .Z({data:this._combineSymbolParts(r,t,s)})}async _getSymbolPart(e,s){if(this._ongoingRequests.has(e))return this._ongoingRequests.get(e).then((e=>e.data));const o=this._refSymbolUrlTemplate.replace(/\\{itemName\\}/gi,e),i=(0,_request_js__WEBPACK_IMPORTED_MODULE_1__["default"])(o,{responseType:"json",query:{f:"json"},...s});this._ongoingRequests.set(e,i);try{return(await i).data}catch(r){return this._ongoingRequests.delete(e),Promise.reject(r)}}_combineSymbolParts(e,t,s){if(!e||0===e.length)return null;const o={...e[0]};if(e.length>1){o.symbolLayers=[];for(const t of e){const e=t;o.symbolLayers.unshift(...e.symbolLayers)}}return s&&(o.callout=h),{type:"CIMSymbolReference",symbol:o,primitiveOverrides:t}}}function u(e,t){if(!e)return;const s=e.symbolLayers;if(!s)return;let o=s.length;for(;o--;){const e=s[o];if(e&&!1!==e.enable&&"CIMVectorMarker"===e.type)p(e,t)}}function p(e,t){const s=e.markerGraphics;if(s)for(const o of s){if(!o)continue;const e=o.symbol;if(e)switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":u(e,t);break;case"CIMTextSymbol":e.fieldMap=t}}}\n\n\n//# sourceURL=webpack://reveal-js-testing/./node_modules/@arcgis/core/renderers/support/DictionaryLoader.js?')}}]);