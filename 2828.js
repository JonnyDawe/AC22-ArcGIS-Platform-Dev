"use strict";(self.webpackChunkreveal_js_testing=self.webpackChunkreveal_js_testing||[]).push([[2828],{74317:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{eval('\n// EXPORTS\n__webpack_require__.d(__webpack_exports__, {\n  "Z": () => (/* binding */ Z)\n});\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/chunks/tslib.es6.js\nvar tslib_es6 = __webpack_require__(36663);\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/core/Accessor.js + 3 modules\nvar Accessor = __webpack_require__(53443);\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/core/Handles.js\nvar Handles = __webpack_require__(44584);\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/core/has.js\nvar has = __webpack_require__(39994);\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/core/Logger.js\nvar Logger = __webpack_require__(13802);\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/core/maybe.js\nvar maybe = __webpack_require__(61681);\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/core/PooledArray.js\nvar PooledArray = __webpack_require__(83575);\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/core/Promise.js\nvar core_Promise = __webpack_require__(64189);\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/core/promiseUtils.js\nvar promiseUtils = __webpack_require__(78668);\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/core/reactiveUtils.js\nvar reactiveUtils = __webpack_require__(76868);\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/core/accessorSupport/decorators/property.js\nvar property = __webpack_require__(81977);\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/core/arrayUtils.js\nvar arrayUtils = __webpack_require__(7753);\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/core/accessorSupport/ensureType.js\nvar ensureType = __webpack_require__(7283);\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/core/accessorSupport/decorators/subclass.js\nvar subclass = __webpack_require__(40266);\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/geometry/projection.js\nvar projection = __webpack_require__(90472);\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/geometry/support/aaBoundingRect.js\nvar aaBoundingRect = __webpack_require__(24568);\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/layers/graphics/dehydratedFeatures.js\nvar dehydratedFeatures = __webpack_require__(48358);\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/layers/support/PromiseQueue.js\nvar PromiseQueue = __webpack_require__(253);\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/views/support/Scheduler.js\nvar Scheduler = __webpack_require__(22167);\n;// CONCATENATED MODULE: ./node_modules/@arcgis/core/views/3d/layers/i3s/I3SFrameTask.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nclass r{constructor(t){this.referenceCount=0,this.callbacks=[],this.runIndex=0,this.handle=t.registerTask(Scheduler/* TaskPriority.I3S_CONTROLLER */.T8.I3S_CONTROLLER,this)}destroy(){this.handle&&(this.handle.remove(),this.handle=null)}get running(){for(const t of this.callbacks)if(t.needsUpdate())return!0;return!1}runTask(t){this._sort();const e=this.callbacks,r={numIndexLoading:0,numNodesLoading:0};for(let s=0;s<e.length&&!t.done;++s)e[s].priority=e[s].update(t,r),this.runIndex=s}_sort(){const t=this.callbacks;let e=t.length;for(let r=this.runIndex;r>0;r--){const s=t[r-1];let n=r;for(;n<t.length&&s.priority<=t[n].priority&&(n!==e||s.priority<t[n].priority);)t[n-1]=t[n],n++;t[n-1]=s,e=n-1}this.runIndex=0}add(t){this._sort(),t.priority=1/0,this.callbacks.unshift(t)}remove(e){(0,arrayUtils/* removeUnordered */.e$)(this.callbacks,e),this.runIndex=this.callbacks.length,this._sort()}}const s=new Map;function n(t,e){let n=s.get(t);return null==n&&(n=new r(t),s.set(t,n)),n.add(e),{remove:()=>{if(null==n)return;n.remove(e);n.callbacks.length>0||(s.delete(t),n.destroy()),n=null}}}\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/chunks/vec3.js\nvar vec3 = __webpack_require__(6766);\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/chunks/vec4f64.js\nvar vec4f64 = __webpack_require__(1983);\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/views/3d/layers/i3s/I3SNode.js\nvar I3SNode = __webpack_require__(79946);\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/views/3d/layers/i3s/I3SUtil.js\nvar I3SUtil = __webpack_require__(78565);\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/views/3d/support/orientedBoundingBox.js + 1 modules\nvar orientedBoundingBox = __webpack_require__(47850);\n;// CONCATENATED MODULE: ./node_modules/@arcgis/core/views/3d/layers/i3s/I3SIndex.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nclass m{constructor(e,t,i,s,r){this.childOffset=e,this.childCount=t,this.visibilityCache=i,this.ref=s,this.node=r,this.useAsHole=0,this.filterImpact=I3SNode/* NodeFilterImpact.NotChecked */.U_.NotChecked}}class f{constructor(e,t,i,r,n,o,d,l,h,u,c,g,_,m){this.streamDataController=i,this.viewportQueries=r,this.logger=n,this.holeFilling=o,this._isLoaded=d,this._isReloading=l,this._isSelected=h,this._enable=u,this._needsUpdate=c,this._canRequest=g,this._computeVisibilityObb=_,this._computeNodeFiltering=m,this._dirty=!0,this._nodePages=[],this.nodeCount=0,this.nodesPerPage=0,this.rootIndex=0,this.lodMetric=I3SNode/* LodMetric.None */.w5.None,this._lodConversion=e=>e,this.urlPrefix="",this._loading=new Set,this._failedNodes=new Set,this._failedPages=new Set,this._indexMissing=1,this._maxUnloadedPrio=Number.NEGATIVE_INFINITY,this._maxProcessingPrio=Number.POSITIVE_INFINITY,this._nodeTraversalState=new Map,this._version=P(0),this._visibilityCacheVersion=P(0),this._maxLevel=1,this._featureEstimate={estimate:0,leavesReached:!1},this._unloadedMemoryEstimate=0,this._missing=new PooledArray/* default */.Z({deallocator:null}),this._prefetch=new PooledArray/* default */.Z({deallocator:null}),this._updates=new b(this._missing),this._imModificationUncategorized=new PooledArray/* default */.Z({deallocator:null}),this.ignoreServiceObb=!1,this.progressiveLoadPenalty=0,this._pageQueue=[],this.layerHasModifications=!1,this._layerHasFilter=!1,this.logLayer=e,e.serviceUpdateTimeStamp&&e.serviceUpdateTimeStamp.lastUpdate&&(this.lastUpdate=`${e.serviceUpdateTimeStamp.lastUpdate}`),this._maxLodLevel=this.viewportQueries?this.viewportQueries.maxLodLevel:1,this._init(t)}_init(e){if("page"===e.type){switch(this.urlPrefix=e.urlPrefix,this.nodesPerPage=e.pageSize,this.rootIndex=e.rootIndex,e.lodMetric){case"maxScreenThreshold":this.lodMetric=I3SNode/* LodMetric.MaxScreenThreshold */.w5.MaxScreenThreshold;break;case"maxScreenThresholdSQ":this.lodMetric=I3SNode/* LodMetric.MaxScreenThreshold */.w5.MaxScreenThreshold,this._lodConversion=L}this._addPage(C(this.rootIndex,this.nodesPerPage),e.rootPage),this._updateParentsAndLevel()}else if("node"===e.type){this.urlPrefix=e.urlPrefix,this._nodePages.push({nodes:[],children:[],parents:[]}),this._makeRefNode(new I3SNode/* NodeBase */.$i(e.rootNode.id,null),-1);const t=this._validateNode(e.rootNode.id,e.rootNode);t&&this._addNode(t,0)}}_loadPage(e){this._loading.add(e);const t=this.urlPrefix+e;this.streamDataController.request(t,"json").then((t=>{this._pageQueue.push({pageIndex:e,page:t})})).catch((t=>{this._loading.delete(e),(0,promiseUtils/* isAbortError */.D_)(t)||(this._failedPages.add(e),this.logger.error("#loadPage()",this.logLayer,`Error when loading page ${e}`,t))}))}_addQueuedPages(e){for(;this._pageQueue.length>0&&!e.done;){const{pageIndex:t,page:i}=this._pageQueue.shift();this._addPage(t,i),this._loading.delete(t),e.madeProgress()}this._updateParentsAndLevel()}_addPage(e,t){for(let n=this._nodePages.length;n<e;n++)this._nodePages[n]=null;const i=[],s=[],r=t.nodes.map(((t,r)=>{const a=i.length,d=t.children?t.children.length:0;s.push(-1);for(let e=0;e<d;e++)i.push(t.children[e]);const h=`${t.index}`,u=(0,orientedBoundingBox/* clone */.d9)(t.obb),c=(0,vec4f64.d)([u.center[0],u.center[1],u.center[2],(0,vec3.l)(u.halfSize)]),g=t.mesh&&t.mesh.attribute,f=t.mesh&&t.mesh.geometry,v=t.mesh&&t.mesh.material,b={hasSharedResource:!1,hasFeatureData:!!f,attributes:g&&null!=g.resource?`${g.resource}`:null,geometry:f&&null!=f.resource?`${f.resource}`:null,texture:v&&null!=v.resource?`${v.resource}`:null,geometryDefinition:f?f.definition:-1,materialDefinition:v?v.definition:-1},p=new I3SNode/* Node */.NB(h,e*this.nodesPerPage+r,c,d,0,b,this.lastUpdate,this.lodMetric,this._lodConversion(t.lodThreshold),f?f.featureCount:null);return p.serviceObb=u,p.visibilityObb=this._computeVisibilityObb(p),p.vertexCount=f?f.vertexCount:0,new m(a,d,y(this._visibilityCacheVersion),null,p)}));this._nodePages[e]={nodes:r,children:i,parents:s},this.nodeCount+=r.length}_updateParentsAndLevel(){const t=new Array,i=(i,s,r)=>{const n=this._getPage(i);if((0,maybe/* isSome */.pC)(n)){const o=w(i,this.nodesPerPage);n.parents[o]=s;const a=n.nodes[o].node;(0,maybe/* isSome */.pC)(a)&&(a.level=r,t.push(i))}};for(i(this.rootIndex,-1,0);t.length;){const s=t.pop(),r=this.getNode(s);if((0,maybe/* isSome */.pC)(r))for(let e=0;e<r.childCount;e++){i(this.getChildIndex(r,e),s,r.level+1),this._maxLevel=Math.max(this._maxLevel,r.level+1)}}}_getPage(e){return this._nodePages[C(e,this.nodesPerPage)]}_getNodeInternal(e){const i=this._getPage(e);return (0,maybe/* isNone */.Wi)(i)?null:i.nodes[w(e,this.nodesPerPage)]}_addNode(t,s){null!=t.children&&this.populateChildren(s,t.children);const r=this.getParent(s),n=(0,maybe/* isSome */.pC)(r)?r.level+1:0;this._maxLevel=Math.max(this._maxLevel,t.children?n+1:n);const{lodMetric:a,maxError:d}=S(t.lodSelection),h=(0,maybe/* unwrap */.Wg)(this._getNodeInternal(s));return h.node=new I3SNode/* Node */.NB(t.id,s,(0,vec4f64.d)(t.mbs),h.childCount,n,t.resources,t.version,a,d,t.numFeatures),t.obb&&(h.node.serviceObb=(0,orientedBoundingBox/* clone */.d9)(t.obb)),h.node.visibilityObb=this._computeVisibilityObb(h.node),(0,maybe/* isSome */.pC)(h.ref)&&(null==h.ref.mbs&&(h.ref.mbs=t.mbs),h.node.renderMbs=h.ref.renderMbs,h.node.serviceObbInRenderSR=h.ref.serviceObbInRenderSR,h.ref.visibilityObb=h.node.visibilityObb),h.node}_makeRefNode(t,i){const s=this._nodePages[0],r=s.nodes.length;return s.nodes.push(new m(0,0,y(this._visibilityCacheVersion),t,null)),this.nodeCount++,s.parents.push(i),t.renderMbs[3]=-1,(0,maybe/* isSome */.pC)(t.serviceObbInRenderSR)&&(t.serviceObbInRenderSR.halfSize[0]=-1),r}populateChildren(e,t){const s=(0,maybe/* unwrap */.Wg)(this._getNodeInternal(e)),r=(0,maybe/* unwrap */.Wg)(this._getPage(e));s.childOffset=r.children.length,s.childCount=t.length;for(let i=0;i<t.length;i++){const s=this._makeRefNode(t[i],e);r.children.push(s)}}getNode(t){const i=this._getNodeInternal(t);return (0,maybe/* isSome */.pC)(i)?i.node:null}getIndexById(t){let i;return this._forAllNodes(((s,r)=>{((0,maybe/* isSome */.pC)(s.node)&&s.node.id===t||(0,maybe/* isSome */.pC)(s.ref)&&s.ref.id===t)&&(i=r)})),i}getNodeById(e){const t=this.getIndexById(e);return t>=0?this.getNode(t):null}getChildIndex(e,i){const s=this._getPage(e.index);if((0,maybe/* isNone */.Wi)(s))return-1;const r=s.nodes[w(e.index,this.nodesPerPage)];return s.children[r.childOffset+i]}getParentIndex(t){const i=this._getPage(t);return (0,maybe/* isSome */.pC)(i)?i.parents[w(t,this.nodesPerPage)]:-1}getParent(e){return(e=this.getParentIndex(e))>=0?this.getNode(e):null}isLeaf(t){const i=this._getNodeInternal(t);return (0,maybe/* isSome */.pC)(i)&&0===i.childCount}get rootNode(){return this.getNode(this.rootIndex)}get size(){return this.nodeCount}invalidateVisibilityCache(){this._visibilityCacheVersion=P(this._visibilityCacheVersion)}invalidateNodeVisibilityCache(t){const i=this._getNodeInternal(t);(0,maybe/* isSome */.pC)(i)&&this.invalidateNodeVisibilityCacheInternal(i)}invalidateNodeVisibilityCacheInternal(e){e.visibilityCache=y(this._visibilityCacheVersion)}invalidateBoundingVolumeCache(t){const i=this._getNodeInternal(t);(0,maybe/* isSome */.pC)(i)&&(p(i),this.invalidateNodeVisibilityCacheInternal(i))}invalidateGeometryVisibility(t){const i=this._getNodeInternal(t);(0,maybe/* isSome */.pC)(i)&&(0,maybe/* isSome */.pC)(i.node)&&(i.node.geometryObb=null,i.node.renderMbs[3]=-1,(0,maybe/* isSome */.pC)(i.node.serviceObbInRenderSR)&&(i.node.serviceObbInRenderSR.halfSize[0]=-1))}invalidateVisibilityObbs(){(0,maybe/* isNone */.Wi)(this.rootNode)||this.traverse(this.rootNode,(e=>(e.visibilityObb=this._computeVisibilityObb(e),e.geometryObb=null,!0)))}isNodeVisible(i){const s=this._getNodeInternal(i);if((0,maybe/* isNone */.Wi)(s)||(0,maybe/* isSome */.pC)(s.ref)&&!s.ref.mbs)return!0;if(!x(s.visibilityCache,this._visibilityCacheVersion)){const i=s.node,r=(0,maybe/* isSome */.pC)(i)&&((0,maybe/* isNone */.Wi)(s.ref)||(0,maybe/* isSome */.pC)(i.visibilityObb))?i:(0,maybe/* isSome */.pC)(s.ref)?s.ref:null;if(this._layerHasFilter&&this._computeNodeFiltering&&((0,maybe/* isSome */.pC)(i)||(0,maybe/* isSome */.pC)(s.ref))&&s.filterImpact===I3SNode/* NodeFilterImpact.NotChecked */.U_.NotChecked){const t=(0,maybe/* isSome */.pC)(i)?i.mbs:(0,maybe/* isSome */.pC)(s.ref)?s.ref.mbs:null;s.filterImpact=null!=t?this._computeNodeFiltering(t):I3SNode/* NodeFilterImpact.Unmodified */.U_.Unmodified}const n=(0,maybe/* isSome */.pC)(i)&&s.filterImpact===I3SNode/* NodeFilterImpact.Culled */.U_.Culled,o=!((0,maybe/* isSome */.pC)(i)&&i.imModificationImpact===I3SNode/* NodeIMModificationImpact.Culled */.O4.Culled)&&(!r||this.viewportQueries.isNodeVisible(r))&&!n;return s.visibilityCache=N(o,this._visibilityCacheVersion),o}return I(s.visibilityCache)}isGeometryVisible(t){if(!this.isNodeVisible(t))return!1;const i=this._getNodeInternal(t);return!((0,maybe/* isSome */.pC)(i)&&(0,maybe/* isSome */.pC)(i.node)&&(0,maybe/* isSome */.pC)(i.node.geometryObb)&&(!this.layerHasModifications||i.node.imModificationImpact!==I3SNode/* NodeIMModificationImpact.NotChecked */.O4.NotChecked))||this.viewportQueries.isGeometryVisible(i.node)}_traverseCoverage(s,r,n,o,a){const d=this._getPage(s);if((0,maybe/* isNone */.Wi)(d)||0===r.childCount)return;const l=r.childOffset+r.childCount,h=new Array;for(let t=r.childOffset;t<l;++t){const i=d.children[t],s=this._getNodeInternal(i);(0,maybe/* isSome */.pC)(s)&&(0,maybe/* isSome */.pC)(s.node)&&this.isGeometryVisible(i)&&h.push(s)}o/=h.length;for(const e of h){const t=(0,maybe/* unwrap */.Wg)(e.node).index;this._isLoaded(t)||this._isReloading(t)?(a.delta=Math.max(a.delta,n),a.coverage+=o):this._traverseCoverage(t,e,n+1,o,a)}}useNodeAsHole(e){if("off"===this.holeFilling)return!1;const i=this._getNodeInternal(e);if((0,maybe/* isNone */.Wi)(i))return!1;if("always"===this.holeFilling)return!0;if(x(i.useAsHole,this._version))return I(i.useAsHole);const s={delta:0,coverage:0};this._traverseCoverage(e,i,0,1,s);const r=s.delta*s.coverage<=.5;return i.useAsHole=N(r,this._version),r}get maxLevel(){return this._maxLevel}get dirty(){return this._dirty}destroy(){this._updates.add.prune(),this._updates.update.prune()}requestUpdate(){this._dirty=!0,this._indexMissing=1,this._version=P(this._version)}imModificationsChanged(t){this.layerHasModifications=t,this._forAllNodes((({node:t})=>{(0,maybe/* isSome */.pC)(t)&&(t.imModificationImpact=I3SNode/* NodeIMModificationImpact.NotChecked */.O4.NotChecked,t.visibilityObb=this._computeVisibilityObb(t),t.hasModifications&&this.invalidateGeometryVisibility(t.index))})),this.invalidateVisibilityCache()}layerFilterChanged(t){this._layerHasFilter=t,this._forAllNodes((t=>{if((0,maybe/* isSome */.pC)(t)){t.filterImpact=I3SNode/* NodeFilterImpact.NotChecked */.U_.NotChecked;const i=t.node;(0,maybe/* isSome */.pC)(i)&&this.invalidateNodeVisibilityCache(i.index)}})),this.invalidateVisibilityCache()}update(s,r,n){if(!this._dirty)return;this._pageQueue.length>0&&this._addQueuedPages(r),this._maxUnloadedPrio=Number.NEGATIVE_INFINITY,this._maxProcessingPrio=Number.NEGATIVE_INFINITY,this._missing.clear(),this._prefetch.clear(),this._updates.reset(s),v.clear();let o=!0;const a=new O,d=new O,l=this._imModificationUncategorized;l.clear();const h=new Set,c=(c,g,_)=>{if((0,maybe/* isNone */.Wi)(g)){let e=this._entryPriority(c);e===1/0&&(e=this._entryPriority(_));const t=C(c,this.nodesPerPage);return v.set(t,Math.max(e,v.get(t)||0)),this._loading.has(t)||this._failedPages.has(t)||this._missing.push(t),void(this._maxProcessingPrio=Math.max(this._maxProcessingPrio,e))}const m=g.node;if(this._updateNodeFeatureEstimate(m,d),(0,maybe/* isNone */.Wi)(m)){const e=this._entryPriority(c);return this._loading.has(c)||this._failedNodes.has(c)||(this._missing.push(c),v.set(c,e)),void(this._maxProcessingPrio=Math.max(this._maxProcessingPrio,e))}const f=(0,maybe/* unwrap */.Wg)(this._getPage(c));if(0===this._missing.length&&0===this.nodesPerPage)for(let t=0;t<g.childCount;t++){const i=f.children[g.childOffset+t],s=this._getNodeInternal(i);!(0,maybe/* isSome */.pC)(s)||s.node||this._loading.has(i)||this._failedNodes.has(i)||(v.set(i,this._entryPriority(i)),this._prefetch.push(i))}if(m.failed)return;if(h.add(m.id),this._isLoaded(c)){if(a.known+=m.memory,++a.knownNodes,this._isSelected(m)?g.childCount>0&&(o=!1):(a.unremoved+=m.memory,o=!1),this._needsUpdate(m)){const e=this._entryPriority(c);v.set(c,e),this._maxProcessingPrio=Math.max(this._maxProcessingPrio,e),this._updates.update.push(c)}return}if(m.memory&&(a.known+=m.memory,++a.knownNodes),!this._isSelected(m))return void(this._isReloading(c)&&this._updates.remove.push(c));if(g.childCount>0&&(o=!1),m.memory?(a.missing+=m.memory,a.known+=m.memory,++a.knownNodes):++a.missingNodes,s.indexOf(m.index)>=0)return this._maxProcessingPrio=Math.max(this._maxProcessingPrio,this._entryPriority(c)),void(this._updates.cancel=this._updates.cancel.filter((e=>e!==m.index)));if(!r.done&&this._enable(m))return void r.madeProgress();const b=this._entryPriority(c);v.set(c,b),this._maxProcessingPrio=Math.max(this._maxProcessingPrio,b),this._updates.add.push(c),this.layerHasModifications&&n&&(0,maybe/* isSome */.pC)(m)&&m.imModificationImpact===I3SNode/* NodeIMModificationImpact.NotChecked */.O4.NotChecked&&l.push(c)};this.traverseVisible(c);const g=this._updates.add;g.length>0&&this.layerHasModifications&&(l.length>0&&n(l),g.filterInPlace((e=>{const i=this._getNodeInternal(e),s=(0,maybe/* isNone */.Wi)(i)||(0,maybe/* isNone */.Wi)(i.node)||i.node.imModificationImpact!==I3SNode/* NodeIMModificationImpact.Culled */.O4.Culled;return s||this.invalidateNodeVisibilityCache(e),s}))),this._unloadedMemoryEstimate=a.missing-a.unremoved,a.knownNodes>3&&a.missingNodes>0&&(this._unloadedMemoryEstimate+=a.known/a.knownNodes*a.missingNodes),this._unloadedMemoryEstimate=.8*Math.max(0,this._unloadedMemoryEstimate),this._featureEstimate.estimate=this._computeFeatureEstimate(d),this._featureEstimate.leavesReached=o,this._missing.sort(((e,t)=>e-t)),this._missing.filterInPlace(((e,t)=>t<1||this._missing.data[t-1]!==e)),this._missing.sort(((e,t)=>v.get(e)-v.get(t))),this._missing.length>0&&(this._maxUnloadedPrio=v.get(this._missing.back()),this._prefetch.clear()),this._updates.add.filterInPlace((e=>v.get(e)>=this._maxUnloadedPrio)).sort(((e,t)=>v.get(e)-v.get(t))),this._updates.update.sort(((e,t)=>v.get(e)-v.get(t))),this._indexMissing=this._loading.size+this._missing.length,this._dirty=this._indexMissing>0,v.clear()}checkFeatureTarget(e,t){const i=this.viewportQueries.updateScreenSpaceErrorBias(t);let s=t,r=t,n=i,o=10;for(;o--;){const i=new O;this._updateFeatureEstimate(s,i);if(this._computeFeatureEstimate(i)<=e){if(s>=t||i.missingNodes>0||0===o)break;n=s,s=.5*(s+r)}else r=s,s=.5*(s+n)}return this._version=P(this._version),this.viewportQueries.updateScreenSpaceErrorBias(i),Math.min(t,s)}_updateFeatureEstimate(t,i){this._version=P(this._version),this.viewportQueries.updateScreenSpaceErrorBias(t),this.traverseVisible(((t,s)=>this._updateNodeFeatureEstimate((0,maybe/* isSome */.pC)(s)&&s.node,i)))}_updateNodeFeatureEstimate(i,s){if(!((0,maybe/* isNone */.Wi)(i)||i.failed||(0,maybe/* isNone */.Wi)(i.numFeatures)))return this._isLoaded(i.index)?(s.known+=i.numFeatures,++s.knownNodes,void(this._isSelected(i)||(s.unremoved+=i.numFeatures))):void(this._isSelected(i)&&((0,maybe/* isSome */.pC)(i.numFeatures)?(s.missing+=i.numFeatures,s.known+=i.numFeatures,++s.knownNodes):++s.missingNodes))}_computeFeatureEstimate(e){let t=e.known-e.unremoved;return e.knownNodes>3&&e.missingNodes>0&&(t+=e.known/e.knownNodes*e.missingNodes),Math.max(0,t)}load(){return this._load(this._missing)}prefetch(){return this._prefetch.sort(((e,t)=>v.get(e)-v.get(t))),this._load(this._prefetch)}_load(e){if(0===e.length||!this._canRequest())return!1;for(;e.length>0&&this._canRequest();)0===this.nodesPerPage?this._loadNode(e.pop()):this._loadPage(e.pop());return!0}isLoading(){return this._indexMissing>0}getIndexLoading(){return this._loading.size}getIndexMissing(){return this._indexMissing}getUnloadedMemoryEstimate(){return this._unloadedMemoryEstimate}get updates(){return this._updates}get featureEstimate(){return this._featureEstimate}nodeTraversalState(e){if((0,maybe/* isNone */.Wi)(e))return null;let i=this._nodeTraversalState.get(e.index);if(i&&x(i.version,this._version))return i;const s=this.viewportQueries.getLodLevel(e),r=this.viewportQueries.hasLOD(e);let n=!0;if(r){const t=this.getParentIndex(e.index);if(t>=0){const e=this._nodeTraversalState.get(t);n=e&&s>e.lodLevel}else n=s>0}else n=0===e.childCount;return i?(i.lodLevel=s,i.isChosen=n,i.version=N(!0,this._version),i):(i=new I3SNode/* NodeTraversalState */.oQ(r,n,s,N(!0,this._version)),this._nodeTraversalState.set(e.index,i),i)}_loadNode(e){this._loading.add(e);const s=(0,maybe/* unwrap */.Wg)(this._getNodeInternal(e)).ref;if((0,maybe/* isNone */.Wi)(s))return void this._failedNodes.add(e);const n=s.id,o=this.urlPrefix+n,a=()=>{this._loading.delete(e),0===this._missing.length&&0===this._loading.size&&this.requestUpdate()};this.streamDataController.request(o,"json").then((t=>{a();const i=this._validateNode(n,t);if(null==i)return;i.obb&&this.invalidateNodeVisibilityCache(e);const s=this._addNode(i,e);this.nodeTraversalState(s)}),(t=>{a(),(0,promiseUtils/* isAbortError */.D_)(t)||(this.logger.error("#loadNode()",this.logLayer,"Error loading node: "+o),this._failedNodes.add(e))}))}_validateNode(e,t){if(null==t||"object"!=typeof t||t.id!==e)return this.logger.error("#validateNode()",this.logLayer,`Invalid node. Wrong type or wrong id "${e}"`),null;if(!Array.isArray(t.mbs))return this.logger.error("#validateNode()",this.logLayer,`Invalid bounding volume on node ${e}.`),null;t.sharedResource&&"./shared"!==t.sharedResource.href&&"./shared/"!==t.sharedResource.href&&this.logger.warn("#validateNode()",this.logLayer,`Invalid shared resource href on node "${e}"`),null==t.geometryData||Array.isArray(t.geometryData)&&1===t.geometryData.length&&"./geometries/0"===t.geometryData[0].href||this.logger.warn("#validateNode()",this.logLayer,`Invalid geometry data on node "${e}"`),null==t.attributeData||Array.isArray(t.attributeData)&&!t.attributeData.some(((e,t)=>e.href!==`./attributes/f_${t}/0`))||this.logger.warn("#validateNode()",this.logLayer,`Invalid attribute data on node "${e}"`),t.featureData&&t.featureData.length>1&&this.logger.warn("#validateNode()",this.logLayer,`Node ${e} has ${t.featureData.length} bundles. Only the first bundle will be loaded.`);const i=t.hasOwnProperty("obb")&&!this.ignoreServiceObb?t.obb:null,s=t.featureData&&1===t.featureData.length&&t.featureData[0].featureRange?t.featureData[0].featureRange[1]-t.featureData[0].featureRange[0]+1:null,r=t=>{if(null==t)return null;const i=t=>this.logger.error("#validateNode()",this.logLayer,`Invalid node reference on node ${e}: ${t}`);if("number"==typeof t.id)i(`id ${t.id} is a number instead of a string.`);else if("string"!=typeof t.id||!Array.isArray(t.mbs))return i("Missing or invalid id."),null;if(!Array.isArray(t.mbs))return i(`Invalid bounding volume on reference ${t.id}.`),null;t.href&&t.href!=="../"+t.id&&this.logger.error("#validateNode()",this.logLayer,`Invalid node href on node "${e}"`);const s=t.hasOwnProperty("obb")&&!this.ignoreServiceObb?t.obb:null,r=new I3SNode/* NodeBase */.$i(`${t.id}`,t.mbs);return r.serviceObb=s,r.visibilityObb=this._computeVisibilityObb(r),r},n=Array.isArray(t.children)?t.children.map(r).filter((e=>null!=e)):null;return{id:e,mbs:t.mbs,obb:i,children:n,resources:{hasFeatureData:t.featureData&&t.featureData.length>0,hasSharedResource:null!=t.sharedResource,attributes:t.attributeData?e:null,texture:t.textureData&&t.textureData.length>0?e:null,geometry:null!=t.geometryData?e:null},version:"string"==typeof t.version?t.version:null,lodSelection:Array.isArray(t.lodSelection)?t.lodSelection:null,numFeatures:s}}resetFailedNodes(){this._failedNodes.clear(),this._failedPages.clear(),this._forAllNodes((t=>{(0,maybe/* isSome */.pC)(t.node)&&(t.node.failed=!1)}))}_entryPriority(i){const s=this._getNodeInternal(i),r=this.getParentIndex(i);if((0,maybe/* isNone */.Wi)(s)||r<0&&null==s.node)return r<0?1/0:this._entryPriority(r);let n=0;if(s.node&&r>=0){const e=this._nodeTraversalState.get(r);null!=e&&(n=e.lodLevel)}let o=this.progressiveLoadPenalty;for(let e=i;e>=0;e=this.getParentIndex(e))if(this._isLoaded(e)){o=0;break}const a=(0,maybe/* isSome */.pC)(s.ref)?this.viewportQueries.distToPOI(s.ref):(0,maybe/* isSome */.pC)(s.node)?this.viewportQueries.distToPOI(s.node):0;return-a-n*(a+this.progressiveLoadPenalty)+o}traverseVisible(e){const i=this._getNodeInternal(this.rootIndex);(0,maybe/* isNone */.Wi)(i)?e(this.rootIndex,null,null):this._traverseVisible(this.rootIndex,-1,i,e)}_traverseVisible(t,s,r,n){if(r.node&&0===r.childCount)return void(this.isGeometryVisible(t)&&n(t,r,s));if(!this.isNodeVisible(t))return;if(n(t,r,s),null==r.node)return;const o=this.nodeTraversalState(r.node);if(o.nodeHasLOD&&o.lodLevel===this._maxLodLevel)return;const a=(0,maybe/* unwrap */.Wg)(this._getPage(t));for(let i=0;i<r.childCount;i++){const s=a.children[r.childOffset+i],o=this._getNodeInternal(s);(0,maybe/* isSome */.pC)(o)?this._traverseVisible(s,t,o,n):n(s,null,t)}}traverse(e,t){t(e)&&this.traverseChildren(e,t)}traverseChildren(t,i){const s=t.index,r=this._getNodeInternal(s);(0,maybe/* isSome */.pC)(r)&&this._traverseChildren(s,r,i)}_traverseChildren(i,s,r){const n=this._getPage(i);if((0,maybe/* isNone */.Wi)(n))return;const o=s.childOffset+s.childCount;for(let t=s.childOffset;t<o;++t){const i=n.children[t],s=this._getNodeInternal(i);(0,maybe/* isSome */.pC)(s)&&(0,maybe/* isSome */.pC)(s.node)&&r(s.node)&&this._traverseChildren(i,s,r)}}updateStats(e){if(this._updates.add.length>0&&(e.nodes+=" + "+this._updates.add.length),(this._indexMissing||this._prefetch.length>0)&&(e.index+=" + "+this._indexMissing||0),e.prio=this._maxProcessingPrio,this._featureEstimate.estimate){const t=this._featureEstimate.estimate-e.features;t>0?e.features+=" + "+t:t<0&&(e.features+=" - "+-t)}}getPriority(){return Math.max(this._maxProcessingPrio,this._maxUnloadedPrio)}updateElevationInfo(e){this._forAllNodes(p),this.viewportQueries.updateElevationInfo(e)}_forAllNodes(e){for(let t=0;t<this._nodePages.length;t++){const i=this._nodePages[t];if(i){const s=t*this.nodesPerPage;for(let t=0;t<i.nodes.length;t++)e(i.nodes[t],s+t)}}}get test(){return{addNode:(e,t)=>this._addNode(e,t)}}}const v=new Map;class b{constructor(e){this.missing=e,this.update=new PooledArray/* default */.Z({deallocator:null}),this.add=new PooledArray/* default */.Z({deallocator:null}),this.remove=new PooledArray/* default */.Z({deallocator:null}),this.cancel=[]}reset(e){this.add.clear(),this.update.clear(),this.cancel=e}}function p(t){(0,maybe/* isSome */.pC)(t.node)&&(t.node.renderMbs[3]=-1,(0,maybe/* isSome */.pC)(t.node.serviceObbInRenderSR)&&(t.node.serviceObbInRenderSR.halfSize[0]=-1)),(0,maybe/* isSome */.pC)(t.ref)&&(t.ref.renderMbs[3]=-1,(0,maybe/* isSome */.pC)(t.ref.serviceObbInRenderSR)&&(t.ref.serviceObbInRenderSR.halfSize[0]=-1))}function y(e){return (0,I3SUtil/* addWraparound */.HV)(e,-2)}function P(e){return (0,I3SUtil/* addWraparound */.HV)(e,2)}function N(e,t){return t+(e?1:0)}function x(e,t){return(-2&e)===t}function I(e){return 1==(1&e)}function C(e,t){return 0===t?0:e/t|0}function w(e,t){return 0===t?e:e%t}const M=[["maxScreenThreshold",I3SNode/* LodMetric.MaxScreenThreshold */.w5.MaxScreenThreshold],["screenSpaceRelative",I3SNode/* LodMetric.ScreenSpaceRelative */.w5.ScreenSpaceRelative],["removedFeatureDiameter",I3SNode/* LodMetric.RemovedFeatureDiameter */.w5.RemovedFeatureDiameter],["distanceRangeFromDefaultCamera",I3SNode/* LodMetric.DistanceRangeFromDefaultCamera */.w5.DistanceRangeFromDefaultCamera]];function S(e){if(e)for(let t=0;t<e.length;t++)for(const i of M)if(i[0]===e[t].metricType)return{lodMetric:i[1],maxError:e[t].maxError};return{lodMetric:I3SNode/* LodMetric.None */.w5.None,maxError:0}}class O{constructor(){this.known=0,this.knownNodes=0,this.missing=0,this.missingNodes=0,this.unremoved=0}}function L(e){return Math.sqrt(e*(4/Math.PI))}\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/views/3d/layers/support/I3SLayerView.js\nvar I3SLayerView = __webpack_require__(73847);\n;// CONCATENATED MODULE: ./node_modules/@arcgis/core/views/3d/layers/i3s/I3SLodHandling.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nclass d{constructor(e){this.layerView=e,this._lodGlobalDirty=!1}startNodeLoading(e,i,o,s){this._maxLodLevel=s.maxLodLevel,this._index=o,this._isNodeInScaleBounds=e,this._removeNodes=i}shouldLoadNode(i){if((0,maybe/* isNone */.Wi)(i))return!1;const o=this._index.nodeTraversalState(i);return!!this._isChosenMaxLOD(o)||!!o.isChosen&&this._childrenRequireLoading(i)}setLodGlobalDirty(){this._lodGlobalDirty=!0}get requiresLODGlobalHandling(){return null!=this._index&&!0===this._lodGlobalDirty}lodGlobalHandling(e){if(!this.requiresLODGlobalHandling)return!1;this._lodGlobalDirty=!1;const i=this.layerView.view.resourceController.memoryController.usedMemory,o=Math.max(0,Math.floor(10*(i-1)));I3SLodHandling_r.clear(),this._lodGlobalHandling(this._index.rootNode,o,!1);const s=I3SLodHandling_r.length;this._removeNodes(I3SLodHandling_r,e);const t=I3SLodHandling_r.length<s;return 0!==I3SLodHandling_r.length&&(this._lodGlobalDirty=!0),I3SLodHandling_r.clear(),t}_lodGlobalHandling(o,d,l){if((0,maybe/* isNone */.Wi)(o))return!1;const n=o.index,a=this._index,h=this.layerView,u=a.nodeTraversalState(o),_=this._isChosenMaxLOD(u),c=h.isNodeLoaded(n),x=h.nodeCrossfadingEnabled;if(x&&c&&_){const e=!l&&this.hasNoVisibleChildren(o);h.fadeNode(n,I3SLayerView/* FadeDirection.FadeIn */.B.FadeIn,!e)}const L=c&&(!h.isNodeFullyFadedIn||h.isNodeFullyFadedIn(n));if(c&&(h.updateNodeState(n,_?I3SNode/* NodeState.Leaf */.FE.Leaf:I3SNode/* NodeState.Hole */.FE.Hole),_))return L&&this._removeChildrenRecursive(o),L;const N=o.childCount>0;let m=N;if(N)for(let e=0;e<o.childCount;e++){const s=a.getChildIndex(o,e),t=a.getNode(s);if((0,maybe/* isSome */.pC)(t)){!(!a.isGeometryVisible(s)||this._lodGlobalHandling(t,d,l||L))&&this._isNodeInScaleBounds(t)&&(m=!1)}else a.isNodeVisible(s)&&(m=!1)}const y=c&&!_&&(m||I3SLodHandling_r.length<d);y&&I3SLodHandling_r.push(n),!x||y||!c||l||m||h.fadeNode(n,I3SLayerView/* FadeDirection.FadeIn */.B.FadeIn,!1);const b=!o.resources.hasFeatureData;return m||L&&!y||b}_removeChildrenRecursive(e){this._index.traverseChildren(e,(e=>((this.layerView.isNodeLoaded(e.index)||this.layerView.isNodeReloading(e.index))&&I3SLodHandling_r.push(e.index),!0)))}hasNoVisibleChildren(e){let i=!0;return this._index.traverseChildren(e,(e=>!(!i||!this._index.isNodeVisible(e.index))&&(!this.layerView.isNodeLoaded(e.index)||(i=!1,!1)))),i}_childrenRequireLoading(e){let i=!1,o=!0;return this._index.traverseChildren(e,(e=>{if(!o||!this._index.isNodeVisible(e.index))return!1;const s=this._index.nodeTraversalState(e);return this._isChosenMaxLOD(s)&&this._index.isGeometryVisible(e.index)&&(i=!0),!this.layerView.isNodeLoaded(e.index)||(o=!1,!1)})),o&&i}_isChosenMaxLOD(e){return e.isChosen&&(!e.nodeHasLOD||e.lodLevel===this._maxLodLevel)}}const I3SLodHandling_r=new PooledArray/* default */.Z({deallocator:null});\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/core/asyncUtils.js\nvar asyncUtils = __webpack_require__(67979);\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/core/lang.js\nvar lang = __webpack_require__(67134);\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/core/urlUtils.js\nvar urlUtils = __webpack_require__(3466);\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/views/3d/layers/i3s/enums.js\nvar enums = __webpack_require__(42114);\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/views/3d/layers/i3s/I3SBinaryReader.js\nvar I3SBinaryReader = __webpack_require__(9512);\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/views/3d/layers/i3s/I3SMaterialUtil.js + 1 modules\nvar I3SMaterialUtil = __webpack_require__(66478);\n;// CONCATENATED MODULE: ./node_modules/@arcgis/core/views/3d/layers/i3s/I3SNodeLoader.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nclass g{constructor(e,t,r,i,o,s){if(this.streamDataController=t,this.logger=r,this.defaultGeometrySchema=i,this.requiredAttributes=o,this.options=s,this.logLayer=e,this.layerUrl=e.parsedUrl.path,this.geometryDefinitions=e.geometryDefinitions,e.materialDefinitions){const t=e.textureSetDefinitions;this.materialAndTextures=e.materialDefinitions.map((e=>(0,I3SMaterialUtil/* getMaterialAndTextures */.R0)(t,e)))}}_load(e,t,r){return this.streamDataController.request(e,t,r)}_loadAttribute(e,t,r){const i=`${this.layerUrl}/nodes/${e.resources.attributes}/attributes/${t.key}/0`;return this._load(i,"binary",r).then((e=>(0,I3SBinaryReader/* readBinaryAttribute */.qM)(t,e)))}loadAttributes(e,t,r){return (0,promiseUtils/* eachAlways */.as)(t.map((t=>this._loadAttribute(e,t.attributeStorageInfo,r)))).then((r=>{const i={};for(let o=0;o<t.length;++o)if(r[o].value)i[t[o].name]=r[o].value;else{if((0,promiseUtils/* isAbortError */.D_)(r[o].error))throw r[o].error;this.logger.error("#loadAttributes",this.logLayer,`Failed to load attributeData for \'${t[o].name}\' on node \'${e.id}\'`,r[o].error)}return i}))}async loadNodeData(r,i){const n=null!=this.requiredAttributes&&r.resources.attributes?(0,asyncUtils/* result */.q6)(this.loadAttributes(r,this.requiredAttributes,i)):null,{bufferDefinition:a,bufferIndex:u}=I3SNodeLoader_x(this.geometryDefinitions,r),l=!!r.resources.geometry,f=l?(0,asyncUtils/* result */.q6)(this._loadGeometry(r.resources.geometry,u,i)):null,c=r.resources.hasSharedResource?await this._loadShared(r,i):null,h=this.materialAndTextures&&r.resources.materialDefinition>=0?this.materialAndTextures[r.resources.materialDefinition]:null!=c?(0,I3SMaterialUtil/* getMaterialAndTexturesFromShared */.Pg)(c):null,g=h&&h.material,A=h&&h.textures,_=`${r.id}`,T=!l&&this.options.loadFeatureData,$=T?await this._loadFeatureData(_,i):null,w=T?I3SNodeLoader_b($):I3SNodeLoader_y(g),j=(0,maybe/* isNone */.Wi)(w)&&D($),I=null!=A&&A.length>0?(0,asyncUtils/* result */.q6)(this.loadTextures(r,A,i)):null;let U=null,S=null;if(f){U=(0,asyncUtils/* assertResult */.w6)(await f);const e=I3SNodeLoader_p(this.defaultGeometrySchema,c);S=(0,I3SBinaryReader/* createGeometryDescriptor */.Es)(a,e)}const q=I?(0,asyncUtils/* assertResult */.w6)(await I):null,v=n?(0,asyncUtils/* assertResult */.w6)(await n):{},B=v?{attributeData:v,loadedAttributes:this.requiredAttributes}:null;return (0,maybe/* isSome */.pC)(w)?{geometryData:w,attributeDataInfo:B,geometryBuffer:U,geometryDescriptor:S,requiredTextures:A,textureData:q}:(0,maybe/* isSome */.pC)(j)?{pointData:j,attributeDataInfo:B,geometryBuffer:U,geometryDescriptor:S,requiredTextures:A,textureData:q}:Promise.reject()}static _addAbsoluteHrefTexture(e,t){const r=e.textureDefinitions;if(null!=r)for(const i of Object.keys(r))for(const e of r[i].images)Array.isArray(e.href)?e.hrefConcat=e.href.map((e=>(0,urlUtils/* makeAbsolute */.hF)(e,t))):e.hrefConcat=(0,urlUtils/* makeAbsolute */.hF)(e.href,t)}static _fixTextureEncodings(e){const t=e.textureDefinitions;if(null!=t)for(const r in t){const e=t[r];if(Array.isArray(e.encoding))for(let t=0;t<e.encoding.length;t++){const r=e.encoding[t];"data:"===r.substring(0,5)&&(e.encoding[t]=r.substring(5))}else{const t=e.encoding;"data:"===t.substring(0,5)&&(e.encoding=t.substring(5))}}}_loadShared(e,t){const r=`${this.layerUrl}/nodes/${e.resources.geometry}/shared`;return this._load(r,"json",t).then((e=>(g._fixTextureEncodings(e),g._addAbsoluteHrefTexture(e,r),e)))}_loadTexture(e,t,r,i,o,s){let n=!1;return o===enums/* TextureEncoding.DDS_S3TC */.j.DDS_S3TC||o===enums/* TextureEncoding.KTX2 */.j.KTX2||o===enums/* TextureEncoding.Basis */.j.Basis?this._load(e,"binary",s).then((e=>({id:t,usage:r,data:e,encoding:o,downsampled:n}))):this._load(e,"image",s).then((e=>{let s=e;const a=4096,u=2;if(i&&e.width*e.height>=a){const t=Math.ceil(e.width/u),r=Math.ceil(e.height/u),i=document.createElement("canvas");i.width=t,i.height=r;i.getContext("2d").drawImage(e,0,0,t,r),s=i,n=!0}return{id:t,usage:r,data:s,encoding:o,downsampled:n}}))}loadTextures(e,t,r){const i=this.options.uncompressedTextureDownsamplingEnabled,o=this.options.textureUsageMask;return Promise.all(t.map((t=>{if(0==(t.usage&o))return null;const s=(0,I3SMaterialUtil/* selectEncoding */.nn)(t.encodings,this.options.textureEncodings);if(null==s)return this.logger.error("#loadTextures",this.logLayer,`No known encoding for texture found on node ${e.id}`),Promise.reject();const n=e.resources.texture||e.id,a=`${this.layerUrl}/nodes/${n}/textures/${s.name}`;return this._loadTexture(a,t.id,t.usage,i,s.encoding,r)})))}_loadFeatureData(e,t){const r=`${this.layerUrl}/nodes/${e}/features/0`;return this._load(r,"json",t)}_loadGeometry(e,t,r){const i=`${this.layerUrl}/nodes/${e}/geometries/${t}`;return this._load(i,"binary",r)}}function I3SNodeLoader_y(e){return{featureIds:[],geometries:[{type:"ArrayBufferView",params:{material:e}}],featureDataPosition:[0,0,0]}}function I3SNodeLoader_b(e){for(const t of e.featureData){const e=t.geometries;if(null!=e)for(const r of e)return{featureIds:[t.id],featureDataPosition:t.position,geometries:[r]}}return null}function D(e){const t=new Array;for(const r of e.featureData)null!=r.position&&t.push({featureIds:[r.id],featureDataPosition:r.position,geometries:null});return t}function I3SNodeLoader_p(e,t){if(!e||!t||!t.materialDefinitions)return e;const r=Object.keys(t.materialDefinitions)[0];return!t.materialDefinitions[r].params.vertexRegions&&e.vertexAttributes.region&&delete(e=(0,lang/* clone */.d9)(e)).vertexAttributes.region,e}function I3SNodeLoader_x(e,t){const i={bufferDefinition:null,bufferIndex:0};if(null==e||t.resources.geometryDefinition<0)return i;const o=t.resources.geometryDefinition>=0?e[t.resources.geometryDefinition].geometryBuffers:null;if(null==o)return i;for(let s=0;s<o.length;s++){const e=o[s];if(null==e.compressedAttributes)i.bufferIndex=s,i.bufferDefinition=o[s];else if("draco"===e.compressedAttributes.encoding&&!(0,has/* default */.Z)("disable-feature:i3s-draco"))return i.bufferIndex=s,i.bufferDefinition=e,i}return i}\n\n;// CONCATENATED MODULE: ./node_modules/@arcgis/core/views/3d/layers/i3s/I3SStreamDataController.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nclass I3SStreamDataController_r{constructor(e,t){this.requester=e,this.apiKey=t,this.activeRequests=new Set}get busy(){return this.requester.busy}request(r,s,l){const o=new AbortController,a=(0,promiseUtils/* onAbortOrThrow */.$F)(l,(()=>o.abort())),n={signal:o.signal,query:{token:this.apiKey}},u=this.requester.request(r,s,n),i={response:u,abortController:o,abortHandle:a};return this.activeRequests.add(i),(0,promiseUtils/* always */.Bx)(u,(()=>{var e;i.abortController=null,null==(e=i.abortHandle)||e.remove(),i.abortHandle=null,this.activeRequests.delete(i)})),u}cancelAll(){this.activeRequests.forEach((e=>{var t,r;null==(t=e.abortController)||t.abort(),e.abortController=null,null==(r=e.abortHandle)||r.remove()})),this.activeRequests.clear()}}\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/chunks/vec3f64.js\nvar vec3f64 = __webpack_require__(8909);\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/chunks/vec4.js\nvar vec4 = __webpack_require__(88589);\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/geometry/projectionEllipsoid.js\nvar projectionEllipsoid = __webpack_require__(25726);\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/geometry/support/frustum.js\nvar frustum = __webpack_require__(59934);\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/chunks/sphere.js\nvar sphere = __webpack_require__(91917);\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/views/3d/layers/graphics/elevationAlignmentUtils.js\nvar elevationAlignmentUtils = __webpack_require__(63669);\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/views/3d/layers/graphics/ElevationContext.js\nvar ElevationContext = __webpack_require__(29642);\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/views/3d/layers/graphics/featureExpressionInfoUtils.js\nvar featureExpressionInfoUtils = __webpack_require__(64487);\n;// CONCATENATED MODULE: ./node_modules/@arcgis/core/views/3d/layers/i3s/I3SViewportQueries.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nconst I3SViewportQueries_O=1e5;class j{constructor(t,e,i,s,r,n,a,o={}){this._indexSR=t,this._renderCoordsHelper=e,this.clippingArea=r,this._elevationProvider=n,this._options=o,this._frustum=(0,frustum/* create */.Ue)(),this._useFrustumCulling=!1,this._poi=(0,vec3f64.c)(),this.minDistance=1/0,this.maxDistance=0,this.maxLodLevel=2,this._tmp1=(0,vec3f64.c)(),this._tmp2=(0,vec3f64.c)(),this._tmp3=(0,vec3f64.c)(),this._tmp0=(0,vec3f64.c)(),this._screenspaceErrorBias=o.screenspaceErrorBias||1,this._progressiveLoadFactor=o.progressiveLoadFactor||1,this.updateCamera(i,s),this.engineSR=this._renderCoordsHelper.spatialReference,this.updateElevationInfo(a),this._tmpPoint=(0,dehydratedFeatures/* makeDehydratedPoint */.Tx)(0,0,0,t)}updateElevationInfo(t){null!=t?(this._elevationContext=ElevationContext/* ElevationContext.fromElevationInfo */.o.fromElevationInfo(t),this._elevationContext.updateFeatureExpressionInfoContext((0,featureExpressionInfoUtils/* createContextWithoutExpressionSupport */.bw)((0,featureExpressionInfoUtils/* extractExpressionInfo */.WI)(t,!1)))):this._elevationContext=null}updateCamera(t,e){this._useFrustumCulling=e,e&&(0,frustum/* fromMatrix */.q_)(t.viewMatrix,t.projectionMatrix,this._frustum),this._screenSizeFactor=1/(t.perScreenPixelRatio/2),this._camPos=t.eye,this.minDistance=1/0,this.maxDistance=0}setPointOfInterest(t){this._poi=t}updateScreenSpaceErrorBias(t){const e=this._screenspaceErrorBias;return this._screenspaceErrorBias=t,e}updateClippingArea(t){this.clippingArea=t}getRenderMbs(t){const e=t.renderMbs;return e[3]<0&&((0,vec4.c)(e,t.mbs),this._elevationContext&&e[3]<I3SViewportQueries_O&&(this._tmpPoint.x=e[0],this._tmpPoint.y=e[1],this._tmpPoint.z=e[2],e[2]=(0,elevationAlignmentUtils/* evaluateElevationAlignmentAtPoint */.w7)(this._tmpPoint,this._elevationProvider,this._elevationContext,this._renderCoordsHelper)),(0,projection/* projectBoundingSphere */.st)(e,this._indexSR,e,this.engineSR)),e}getVisibilityObb(i){if((0,maybe/* isSome */.pC)(i.visibilityObb))return i.visibilityObb;const s=i.serviceObb;return (0,maybe/* isNone */.Wi)(s)||s.halfSize[0]<0?void 0:(i.serviceObbInRenderSR=this._computeRenderObb(s,i.serviceObbInRenderSR,i.mbs[3]),i.serviceObbInRenderSR)}_computeRenderObb(t,i,s){if((0,maybe/* isNone */.Wi)(i)&&(i=(0,orientedBoundingBox/* create */.Ue)()),i.halfSize[0]<0){let e=0;this._elevationContext&&s<I3SViewportQueries_O&&(this._tmpPoint.x=t.center[0],this._tmpPoint.y=t.center[1],this._tmpPoint.z=t.center[2],e=(0,elevationAlignmentUtils/* evaluateElevationAlignmentAtPoint */.w7)(this._tmpPoint,this._elevationProvider,this._elevationContext,this._renderCoordsHelper)-t.center[2]),(0,I3SUtil/* transformObb */.jv)(t,this._indexSR,i,this.engineSR,e)}return i}isNodeVisible(e){const i=this.getRenderMbs(e);if(!this._isMBSinClippingArea(i))return!1;if(!this._useFrustumCulling)return!0;const s=this.getVisibilityObb(e);return (0,maybe/* isSome */.pC)(s)?(0,orientedBoundingBox/* isVisible */.pn)(s,this._frustum):(0,frustum/* intersectsSphere */.hr)(this._frustum,(0,sphere.w)(i))}isGeometryVisible(e){if(!this._useFrustumCulling)return!0;const i=e.geometryObb;return (0,maybe/* isSome */.pC)(i)?(0,orientedBoundingBox/* isVisible */.pn)(i,this._frustum):this.isNodeVisible(e)}_isMBSinClippingArea(t){return!!(0,maybe/* isNone */.Wi)(this.clippingArea)||(0,I3SUtil/* intersectBoundingRectWithMbs */.cr)(this.clippingArea,t)!==I3SUtil/* MbsIntersectResult.OUTSIDE */.pD.OUTSIDE}_screenSpaceDiameterMbs(t,e){const s=this.getRenderMbs(t),r=Math.sqrt((0,vec3.h)(s,this._camPos)),n=r-s[3];return this._updateMinMaxDistance(r),n<0?.5*Number.MAX_VALUE:e/n*this._screenSizeFactor}calcCameraDistance(t){return this.calcCameraDistanceToCenter(t)-this.getRenderMbs(t)[3]}calcCameraDistanceToCenter(t){const e=this.getRenderMbs(t),i=(0,vec3.i)(e,this._camPos);return this._updateMinMaxDistance(i),i}calcAngleDependentLoD(t){const e=this.getRenderMbs(t),i=e[3],n=(Math.abs(e[0]*(e[0]-this._camPos[0])+e[1]*(e[1]-this._camPos[1])+e[2]*(e[2]-this._camPos[2]))/(0,vec3.l)(e)+i)/(0,vec3.i)(e,this._camPos);return Math.min(1,n)}hasLOD(t){return t.lodMetric!==I3SNode/* LodMetric.None */.w5.None}_getDistancePlanarMode(t,e){const i=t[0]-e[0],s=t[1]-e[1],r=t[2]-e[2],n=i*i+s*s,a=e[3];if(n<=a*a)return Math.abs(r);const o=Math.sqrt(n)-a;return Math.sqrt(r*r+o*o)}_getDistanceGlobeMode(t,e){const m=(0,vec3.l)(e),p=(0,vec3.l)(t)-m;(0,vec3.a)(this._tmp0,t,(0,vec3.d)(t,e)/(0,vec3.p)(t));const u=(0,vec3.h)(e,this._tmp0),_=e[3];if(u<=_*_)return Math.abs(p);{const i=(0,vec3.a)(this._tmp0,e,1/m),o=m,u=_*_/2/o,l=(0,vec3.a)(this._tmp1,i,o-u),d=t,b=(0,vec3.f)(this._tmp2,d,l),g=(0,vec3.f)(this._tmp2,b,(0,vec3.a)(this._tmp3,i,(0,vec3.d)(i,b))),f=(0,vec3.b)(this._tmp2,l,(0,vec3.a)(this._tmp2,g,_/(0,vec3.l)(g)));let v=(0,vec3.i)(d,f);if(p>=2e5){const t=(0,vec3.f)(this._tmp1,d,f);let e=(0,vec3.d)(t,i)/(0,vec3.l)(t);e<.08&&(e=1e-4),v/=e}return v}}_getDistance(t,e){return this.engineSR===(0,projectionEllipsoid/* getSphericalPCPF */.rS)(this.engineSR)?this._getDistanceGlobeMode(t,e):this._getDistancePlanarMode(t,e)}_updateMinMaxDistance(t){t>0?(this.minDistance=Math.min(this.minDistance,t),this.maxDistance=Math.max(this.maxDistance,t)):(this.minDistance=0,this.maxDistance=Math.max(this.maxDistance,-t))}getLodLevel(t){if(t.lodMetric===I3SNode/* LodMetric.None */.w5.None)return 0;if(0===t.childCount)return this.maxLodLevel;if(this._useFrustumCulling&&this._progressiveLoadFactor<1){const e=this._progressiveLoadFactor*this._screenspaceErrorBias,i=this._screenspaceErrorBias;return this.evaluateLODmetric(t,e)?this.evaluateLODmetric(t,i)?2:1:0}return this.evaluateLODmetric(t,this._screenspaceErrorBias)?this.maxLodLevel:0}evaluateLODmetric(t,e){switch(t.lodMetric){case I3SNode/* LodMetric.ScreenSpaceRelative */.w5.ScreenSpaceRelative:{const i=this.getRenderMbs(t),s=this._getDistance(this._camPos,i),r=2*s/this._screenSizeFactor,n=s+i[3];return this._updateMinMaxDistance(n),t.maxError*e<=r}case I3SNode/* LodMetric.MaxScreenThreshold */.w5.MaxScreenThreshold:{let i=this._screenSpaceDiameterMbs(t,t.mbs[3]*e);return this._options.angleDependentLoD&&(i*=this.calcAngleDependentLoD(t)),i<t.maxError}case I3SNode/* LodMetric.RemovedFeatureDiameter */.w5.RemovedFeatureDiameter:return this._screenSpaceDiameterMbs(t,t.maxError)*e<10;case I3SNode/* LodMetric.DistanceRangeFromDefaultCamera */.w5.DistanceRangeFromDefaultCamera:return this.calcCameraDistance(t)>t.maxError*e}return!1}distToPOI(t){const e=this.getRenderMbs(t);return (0,vec3.i)(e,this._poi)-e[3]}distCameraToPOI(){return (0,vec3.i)(this._camPos,this._poi)}}\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/views/3d/support/extentUtils.js\nvar extentUtils = __webpack_require__(76557);\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/views/3d/support/index.js\nvar support = __webpack_require__(25024);\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/views/support/layerViewUtils.js\nvar layerViewUtils = __webpack_require__(42780);\n;// CONCATENATED MODULE: ./node_modules/@arcgis/core/layers/graphics/controllers/I3SOnDemandController.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nconst I3SOnDemandController_j=Logger/* default.getLogger */.Z.getLogger("esri.layers.graphics.controllers.I3SOnDemandController"),G=100,Q=2,T=1e4,E=1e-4,B=1.2,H=500,k=1.5;let R=class extends((0,core_Promise/* EsriPromiseMixin */.v)(Accessor/* default */.Z)){constructor(e){super(e),this.screenSizeFactor=0,this.featureTarget=5e4,this.fixedFeatureTarget=!1,this.updating=!0,this.updatingProgress=1,this.leavesReached=!1,this.scaleVisibilityEnabled=!0,this._featureLOD=1,this._stableFeatureLOD=!1,this._isIdle=!1,this._cameraDirty=!0,this._invisibleDirty=!1,this._newLoadingNodes=new PooledArray/* default */.Z({deallocator:null}),this._loadedNodeScales=new Map,this._modificationsNodeFilteringArray=new PooledArray/* default */.Z,this._downloadingCount=0,this._loadingNodes=new Map,this._updatingNodes=new Map,this._progressMaxNumNodes=1,this._requiredAttributes=new Array,this._requiredAttributesDirty=!0,this._updatesDisabled=!1,this.disableIDBCache=!1,this._disableMemCache=!1,this._restartNodeLoading=!1,this._fields=null,this._attributeStorageInfo=null,this._handles=new Handles/* default */.Z,this._idleQueue=new PromiseQueue/* PromiseQueue */.b,this._elevationUpdateNodes=new PooledArray/* default */.Z({deallocator:null}),this._errorCount=0}get isMeshPyramid(){return"mesh-pyramids"===this.layer.profile||"MeshPyramid"===this.layer.store.lodType}get isGraphics3D(){return"points"===this.layer.profile}get useMaximumNumberOfFeatures(){return!this.isMeshPyramid&&(this.layer.version.major<2||!(0,has/* default */.Z)("enable-feature:point-base-layer"))}get indexStreamController(){const e=this.layerView.view.resourceController.createStreamDataRequester(support/* ClientType.I3S_INDEX */.Bh.I3S_INDEX);return new I3SStreamDataController_r(e,this.layer.apiKey)}get dataStreamController(){const e=this.layerView.view.resourceController.createStreamDataRequester(support/* ClientType.I3S_DATA */.Bh.I3S_DATA);return new I3SStreamDataController_r(e,this.layer.apiKey)}get crsVertex(){return (0,I3SUtil/* getVertexCrs */.T2)(this.layer)}get crsIndex(){return (0,I3SUtil/* getIndexCrs */.tp)(this.layer)}get rootNodeVisible(){if((0,maybe/* isSome */.pC)(this._index)){const e=this._index.rootNode;if((0,maybe/* isSome */.pC)(e))return this._updateViewData(),this._index.isNodeVisible(e.index)}return!0}get index(){return this._index}initialize(){this._disableMemCache=!this.layerView.loadCachedGPUData||!this.layerView.addCachedGPUData,this._lodHandling=new d(this.layerView);const e=this.layerView.i3slayer;this.layer=e,this._defaultGeometrySchema=e.store.defaultGeometrySchema,this.disableIDBCache=(0,has/* default */.Z)("disable-feature:idb-cache"),"fields"in e&&(this._fields=e.fields,this._attributeStorageInfo=e.attributeStorageInfo),this.addResolvingPromise(Promise.all([this.layer.indexInfo,this.layer.when(),this.layerView.when()]).then((([t])=>{var i;if(this.destroyed||!this.layerView||this.layerView.destroyed)return;const s=this.layerView.view;this._setClippingArea(s.clippingArea);const a=this.layerView.view.resourceController;this._handles.add([(0,reactiveUtils/* watch */.YP)((()=>{var e,t;return null==s||null==(e=s.pointsOfInterest)||null==(t=e.focus)?void 0:t.renderLocation}),(e=>this._pointOfInterestChanged(e)),reactiveUtils/* initial */.nn),a.memoryController.events.on("quality-changed",(()=>this._setCameraDirty())),(0,reactiveUtils/* watch */.YP)((()=>{var e;return null==(e=this.layerView)?void 0:e.suspended}),(e=>{const t=e?()=>this._updateViewData():()=>this._updateIdleState(!0),i=e?()=>{}:()=>this._updateIdleState(!1);this._idleStateCallbacks?(e&&this.cancelNodeLoading(),this.restartNodeLoading(),this._idleStateCallbacks.idleBegin=t,this._idleStateCallbacks.idleEnd=i):this._idleStateCallbacks=a.scheduler.registerIdleStateCallbacks(t,i)}),reactiveUtils/* initial */.nn),n(this.layerView.view.resourceController.scheduler,{update:(e,t)=>this._frame(e,t),needsUpdate:()=>this.updating}),this.watch("uncompressedTextureDownsamplingEnabled",(()=>this.restartNodeLoading())),this.watch(["featureTarget","fixedFeatureTarget"],(()=>{this._setCameraDirty(),this._stableFeatureLOD=!1})),s.state.watch("contentCamera",(()=>this._setCameraDirty())),this.layer.watch("elevationInfo",(()=>this._elevationInfoChanged())),this.layer.watch("effectiveScaleRange",(()=>this._scaleBoundsChanged())),this.layerView.watch("lodFactor",(()=>this._setCameraDirty())),this.layerView.watch("availableFields?",(()=>this._requiredFieldsChange())),this.layerView.watch("holeFilling",(e=>(0,maybe/* isSome */.pC)(this._index)&&(this._index.holeFilling=e)))]),this._updateScaleHandles(),this._viewportQueries=new j(this.crsIndex,s.renderCoordsHelper,s.state.contentCamera,!s.state.fixedContentCamera||this.isGraphics3D,this._clippingArea,s.elevationProvider,this.layer.elevationInfo,{progressiveLoadFactor:this._getProgressiveLoadFactor(),screenspaceErrorBias:this.lod,angleDependentLoD:this.lod<.5}),this._index=new f(e,t,this.indexStreamController,this._viewportQueries,I3SOnDemandController_j,this.layerView.holeFilling,(e=>this.layerView.isNodeLoaded(e)),(e=>this.layerView.isNodeReloading(e)),(e=>this._shouldLoadNode(e)),(e=>this._enableFromGPUCache(e,I3SNode/* NodeState.Leaf */.FE.Leaf)),(e=>this._needsUpdate(e)),(()=>!this.indexStreamController.busy),(e=>this.layerView.computeVisibilityObb?this.layerView.computeVisibilityObb(e):null),null!=(i=this.layerView)&&i.computeNodeFiltering?e=>this.layerView.computeNodeFiltering(e):void 0),this._index.imModificationsChanged(!!this.layerView.hasModifications),this._startNodeLoading()}))),this._tmpPoint=(0,dehydratedFeatures/* makeDehydratedPoint */.Tx)(0,0,0,this.crsIndex)}updateNodeModificationStatus(e){const t=this._index,i=this.layerView;(0,maybe/* isSome */.pC)(t)&&i&&i.updateNodeModificationStatus&&(this._modificationsNodeFilteringArray.clear(),e.forAll((e=>{const i=t.getNode(e);(0,maybe/* isSome */.pC)(i)&&this._modificationsNodeFilteringArray.push(i)})),i.updateNodeModificationStatus(this._modificationsNodeFilteringArray),this._invisibleDirty=!0)}destroy(){this.cancelNodeLoading(),this._idleStateCallbacks&&(this._isIdle=!1,this._idleStateCallbacks.remove(),this._idleStateCallbacks=null),this._handles.destroy(),this._nodeLoader=null,z.prune(),(0,maybe/* isSome */.pC)(K)&&(K.hide(),K=null)}_getRequiredAttributes(){if(null==this._attributeStorageInfo||!this._fields||!this.layerView.availableFields)return[];const e=this._attributeStorageInfo,t=this._fields,i=this.layer.objectIdField;return this.layerView.availableFields.map((i=>{const s=$(e,i),a=$(t,i);return s>=0&&a>=0?{index:s,name:t[a].name,field:t[a],attributeStorageInfo:e[s]}:null})).filter((e=>null!=e&&e.name!==i))}_requiredFieldsChange(){const e=this._getRequiredAttributes();X(this._requiredAttributes,e)||(this._requiredAttributes=e,this._requiredAttributesDirty=!1,this.restartNodeLoading())}requestUpdate(){this._requiredAttributesDirty=!0,this.restartNodeLoading()}_setClippingArea(e){const t=(0,aaBoundingRect/* create */.Ue)();(0,extentUtils/* toBoundingRect */.G)(e,t,this.layerView.view.renderSpatialReference)?this._clippingArea=t:this._clippingArea=null}_pointOfInterestChanged(e){(0,maybe/* isSome */.pC)(this._viewportQueries)&&(this._viewportQueries.setPointOfInterest(e),(0,maybe/* isSome */.pC)(this._index)&&(this._index.progressiveLoadPenalty=J.distancePenalty*this._viewportQueries.distCameraToPOI(),this._index.requestUpdate()))}updateClippingArea(e){this._setClippingArea(e),(0,maybe/* isSome */.pC)(this._viewportQueries)&&(0,maybe/* isSome */.pC)(this._index)&&(this._viewportQueries.updateClippingArea(this._clippingArea),this._index.invalidateVisibilityCache()),this._setCameraDirty()}_setCameraDirty(){this._cameraDirty=!0,this.notifyChange("rootNodeVisible"),this._lodHandling.setLodGlobalDirty(),this._evaluateUpdating()}updateElevationChanged(e,t){const i=this._index;if((0,maybe/* isNone */.Wi)(i))return;const s=i.rootNode;if((0,maybe/* isNone */.Wi)(s))return;const a=this._elevationUpdateNodes;a.clear(),(0,I3SUtil/* findIntersectingNodes */.tS)(e,t,s,this.crsIndex,i,(e=>a.push(e.index))),a.forAll((e=>{i.invalidateBoundingVolumeCache(e),e===s.index&&this.notifyChange("rootNodeVisible")})),a.length&&this.restartNodeLoading()}getParentIndex(e){return (0,maybe/* isSome */.pC)(this._index)&&this._index.getParentIndex(e)}_elevationInfoChanged(){(0,maybe/* isSome */.pC)(this._index)&&this._index.updateElevationInfo(this.layer.elevationInfo),this._setCameraDirty()}_updateScaleHandles(){const e="scale-bounds";this._handles.remove(e),this.areScaleBoundsActive&&this._handles.add(this.layerView.view.basemapTerrain.on("scale-change",(e=>this._scaleUpdateHandler(e))),e)}_scaleBoundsChanged(){this.areScaleBoundsActive||this._loadedNodeScales.clear(),this._updateScaleHandles(),this._setCameraDirty()}_scaleUpdateHandler(e){this._updateScaleInBoundingRect(e.extent,e.spatialReference),this._setCameraDirty()}_updateScaleInBoundingRect(e,t){const i=this._index;if((0,maybe/* isNone */.Wi)(i))return;const s=i.rootNode;!(0,maybe/* isNone */.Wi)(s)&&(0,projection/* projectBoundingRect */.dH)(e,t,W,this.crsIndex)&&this._loadedNodeScales.forEach(((e,t)=>{const s=i.getNode(t);(0,maybe/* isSome */.pC)(s)&&(0,aaBoundingRect/* intersectsSphere */.hr)(W,s.mbs)&&this._loadedNodeScales.set(t,this._computeScale(s))}))}restartNodeLoading(){this._restartNodeLoading=!0,this.cancelNodeLoading(),this._evaluateUpdating()}schedule(e,t){return this._idleQueue.push(e,t)}reschedule(e,t){return this._idleQueue.unshift(e,t)}get isIntegratedMesh(){return"integrated-mesh"===this.layer.type}get areScaleBoundsActive(){const{minScale:e,maxScale:t}=(0,layerViewUtils/* extractSafeScaleBounds */.lu)(this.layer);return this.scaleVisibilityEnabled&&(e>0||t>0)}get unloadedMemoryEstimate(){return (0,maybe/* isNone */.Wi)(this._index)||this.layerView.suspended?0:this._index.getUnloadedMemoryEstimate()*this.lodDropFactor}get indexDepth(){return (0,maybe/* isSome */.pC)(this._index)?this._index.maxLevel:0}set disableMemCache(e){this.layerView.loadCachedGPUData&&this.layerView.addCachedGPUData||(this._disableMemCache=!0),this._disableMemCache=e}_frame(e,t){return this.layerView.suspended?(this._updateViewData(),this._evaluateUpdating(),-1/0):!this.layerView.visible||(0,maybe/* isNone */.Wi)(this._index)?-1/0:(this._processLogError(e,t),this._index.getPriority())}_processLogError(e,t){try{this._process(e,t)}catch(i){this._errorCount<50?I3SOnDemandController_j.error("Error during processing: "+i):50===this._errorCount&&I3SOnDemandController_j.error("Too many errors for this layer. Further errors will not be displayed."),this._errorCount++}}_process(e,t){this._restartNodeLoading&&this._startNodeLoading(),null==this._nodeLoader||(0,maybe/* isNone */.Wi)(this._index)||(this._updateViewData(),this._invisibleDirty&&this._removeInvisibleNodes(e)&&(this._invisibleDirty=!1),this.isIntegratedMesh&&(e.enabled=!1),e.run((()=>this._processIndex(e))),this._updateFeatureLOD(),e.run((()=>this._processCache(e))),this.isIntegratedMesh&&(e.enabled=!0),e.run((()=>this._processNodes(e,t))),this._idleQueue.runTask(e),e.run((()=>this._prefetchIndex())),t.numIndexLoading+=this._index.getIndexLoading(),t.numNodesLoading+=this._downloadingCount,e.run((()=>this._lodHandling.lodGlobalHandling(e))),this._evaluateUpdating())}_processIndex(e){if((0,maybe/* isNone */.Wi)(this._index))return!1;if(this._index.dirty){this._newLoadingNodes.clear(),this._index.update([...this._loadingNodes.keys()],e,(e=>this.updateNodeModificationStatus(e))),this._disableMemCache||(this._newLoadingNodes.pushArray(this._index.updates.add.data,this._index.updates.add.length),this._newLoadingNodes.pushArray(this._index.updates.missing.data,this._index.updates.missing.length));const t=this._index.featureEstimate.leavesReached;this._index.isLoading()||t===this._get("leavesReached")||this._set("leavesReached",t)}return this._index.load()}_prefetchIndex(){return!((0,maybe/* isNone */.Wi)(this._index)||this._loadingNodes.size>0||this._index.updates.add.length>0)&&this._index.prefetch()}_updateFeatureLOD(){if(!this.useMaximumNumberOfFeatures||(0,maybe/* isNone */.Wi)(this._index)||(0,maybe/* isNone */.Wi)(this._viewportQueries))return;const e=!this._index.isLoading(),t=this.featureTarget*this.baseLOD,i=this._index.featureEstimate;if(i.estimate=i.estimate||t/2,this._index.getIndexMissing()>H){if(this._featureLOD<=E)return;this._featureLOD/=k,this._stableFeatureLOD=!1}else if(e&&i.estimate<t){if(i.leavesReached||this._featureLOD>=T||this._stableFeatureLOD)return;const e=Math.min(10,Math.max(t/i.estimate,1.001));this._featureLOD*=e;const s=this.lod,a=this._index.checkFeatureTarget(t,s);a!==s&&(this._featureLOD=a/this.baseLOD,this._stableFeatureLOD=!0)}else{if(!(i.estimate>t*B||e&&i.estimate>t))return;if(this._featureLOD<=E)return;this._featureLOD/=1+.25*(i.estimate/t-1),this._stableFeatureLOD=!1}this._featureLOD=Math.min(T,Math.max(E,this._featureLOD)),this._viewportQueries.updateScreenSpaceErrorBias(this.lod),this._index.requestUpdate()}_processCache(e){const t=this._index;if((0,maybe/* isNone */.Wi)(t))return!1;for(;this._newLoadingNodes.length>0&&!e.done;){const i=this._newLoadingNodes.pop();for(let s=t.getParent(i);(0,maybe/* isSome */.pC)(s)&&(!this.layerView.isNodeLoaded(s.index)&&this._isNodeInScaleBounds(s));s=t.getParent(s.index))if(this._enableFromGPUCache(s,I3SNode/* NodeState.Hole */.FE.Hole)){e.madeProgress();break}}return e.hasProgressed}_processNodes(e,t){if((0,maybe/* isNone */.Wi)(this._index))return!1;let i=(this._isIdle?G:Q)-this._loadingNodes.size;const s=this._index.updates;for(s.cancel.forEach(this._cancelNode,this),s.cancel=[];s.remove.length>0&&!e.done;)this.layerView.removeNode(s.remove.pop()),e.madeProgress();for(;s.update.length>0&&!e.done;){const t=this._index.getNode(s.update.pop());(0,maybe/* isSome */.pC)(t)&&(this._updateLoadedNode(t),e.madeProgress())}for(;s.add.length>0&&!e.done&&i>0;){--i;const a=this._index.getNode(s.add.back());if((0,maybe/* isNone */.Wi)(a)||a.cacheState!==I3SNode/* CacheState.Cached */.Hw.Cached&&!this._hasNodeLoadToken(t))break;s.add.pop(),this._loadNode(a),e.madeProgress()}return e.hasProgressed}_cancelAllNodes(){this._loadingNodes.forEach((e=>e.abort())),this._loadingNodes.clear(),this._updatingNodes.forEach((e=>e.abort())),this._updatingNodes.clear()}_cancelNode(e){const t=this._loadingNodes.get(e);t&&(t.abort(),this._loadingNodes.delete(e))}_hasNodeLoadToken(e){return!(!this._isIdle&&e.numNodesLoading+this._loadingNodes.size>=Q)&&(this._downloadingCount<support/* maxDownloadSlots */.NT&&!this.dataStreamController.busy)}_evaluateUpdating(){let e=!1,t=0;if(this.layerView.suspended)e=this._cameraDirty,t=e?0:1;else{const i=((0,maybe/* isSome */.pC)(this._index)?this._index.getIndexMissing():0)+3*((0,maybe/* isSome */.pC)(this._index)?this._index.updates.add.length:0)+2*this._loadingNodes.size;e=!!(i>0||this._updatingNodes.size>0||this._restartNodeLoading||this._cameraDirty||this._idleQueue.running||this._lodHandling&&this._lodHandling.requiresLODGlobalHandling),0===i&&(this._progressMaxNumNodes=1),this._progressMaxNumNodes=Math.max(i,this._progressMaxNumNodes),t=1-i/this._progressMaxNumNodes}this.updating=e,this.updatingProgress=t}_updateViewData(){if(!this._cameraDirty||(0,maybe/* isNone */.Wi)(this._index)||(0,maybe/* isNone */.Wi)(this._viewportQueries))return;const e=this.layerView.view,{contentCamera:t,fixedContentCamera:i}=e.state;this.screenSizeFactor=1/(t.perScreenPixelRatio/2),this._viewportQueries.updateCamera(t,!i||this.isGraphics3D),this._viewportQueries.setPointOfInterest(e.pointsOfInterest.focus.renderLocation),this._viewportQueries.updateScreenSpaceErrorBias(this.lod),this._index.invalidateVisibilityCache(),this._index.progressiveLoadPenalty=J.distancePenalty*this._viewportQueries.distCameraToPOI(),this._index.requestUpdate(),this._stableFeatureLOD=!1,this._invisibleDirty=!0,this._cameraDirty=!1,this.notifyChange("rootNodeVisible")}_getProgressiveLoadFactor(){return this.layerView.view.resourceController.memoryController.memoryFactor<1?1:this.layerView.progressiveLoadFactor}get lod(){return this._featureLOD*this.baseLOD}get baseLOD(){const e=this.layerView.lodFactor,t=this.layerView.view.resourceController.memoryController.memoryFactor;return this.fixedFeatureTarget?1:(e>0?e:1)*t}get lodDropFactor(){if(this.fixedFeatureTarget)return 1;const e=this.layerView.view.resourceController.memoryController;return(Math.min(e.memoryFactor,.5)-e.minQuality)/(.5-e.minQuality)}isGeometryVisible(e){return (0,maybe/* isSome */.pC)(this._index)&&this._index.isGeometryVisible(e.index)}updateVisibility(e){(0,maybe/* isSome */.pC)(this._index)&&this._index.invalidateNodeVisibilityCache(e)}updateBoundingVolume(e){(0,maybe/* isSome */.pC)(this._index)&&this._index.invalidateBoundingVolumeCache(e)}invalidateGeometryVisibility(e){(0,maybe/* isSome */.pC)(this._index)&&this._index.invalidateGeometryVisibility(e)}invalidateVisibilityObbs(){(0,maybe/* isSome */.pC)(this._index)&&this._index.invalidateVisibilityObbs()}modificationsChanged(){(0,maybe/* isSome */.pC)(this._index)&&this._index.imModificationsChanged(!!this.layerView.hasModifications),this._invisibleDirty=!0}_shouldLoadNode(e){return!(!this._lodHandling.shouldLoadNode(e)||this._shouldDropNode(e))&&(!(!(0,maybe/* isSome */.pC)(this._index)||!this._index.isGeometryVisible(e.index))&&this._isNodeInScaleBounds(e))}_shouldDropNode(e){if((0,maybe/* isNone */.Wi)(this._viewportQueries))return!1;const t=this.lodDropFactor;if(t>=1||!this._lodHandling.hasNoVisibleChildren(e))return!1;return Math.abs(this._viewportQueries.calcCameraDistanceToCenter(e))-this._viewportQueries.minDistance>(this._viewportQueries.maxDistance-this._viewportQueries.minDistance)*t}_startNodeLoading(){this._restartNodeLoading=!1;const e=this._index;if(this._updatesDisabled||(0,maybe/* isNone */.Wi)(e)||(0,maybe/* isNone */.Wi)(this._viewportQueries))return;this._updateViewData(),this._requiredAttributesDirty&&(this._requiredAttributes=this._getRequiredAttributes(),this._requiredAttributesDirty=!1);const t={textureEncodings:this.layerView.supportedTextureEncodings,uncompressedTextureDownsamplingEnabled:this.layerView.uncompressedTextureDownsamplingEnabled,textureUsageMask:this.layerView.rendererTextureUsage,loadFeatureData:this.useMaximumNumberOfFeatures};this._nodeLoader=new g(this.layer,this.dataStreamController,I3SOnDemandController_j,this._defaultGeometrySchema,this._requiredAttributes,t),e.requestUpdate(),this._lodHandling.startNodeLoading((e=>this._isNodeInScaleBounds(e)),((e,t)=>this._removeNodes(e,t,Y.fadeout)),e,{maxLodLevel:this._viewportQueries.maxLodLevel}),this._evaluateUpdating()}isNodeLoading(){return null!=this._nodeLoader&&null!=this._index}cancelNodeLoading(){this.isNodeLoading()&&(this.indexStreamController.cancelAll(),this.dataStreamController.cancelAll(),this._idleQueue.cancelAll(),this._cancelAllNodes(),this._nodeLoader=null,this._evaluateUpdating())}_removeInvisibleNodes(e){const t=this._index;if((0,maybe/* isNone */.Wi)(t)||(0,maybe/* isNone */.Wi)(this._viewportQueries))return!1;z.clear(),this.layerView.getLoadedNodeIndices(z);const i=0===this._viewportQueries.maxDistance,s=i?()=>!1:e=>this._shouldDropNode(e);return z.filterInPlace((e=>{const i=t.getNode(e);return (0,maybe/* isNone */.Wi)(i)||!t.isGeometryVisible(e)||s(i)||!this._isNodeInScaleBounds(i)})),z.length>0&&this._lodHandling.setLodGlobalDirty(),this._removeNodes(z,e,Y.pop),!(i&&this.lodDropFactor<1)&&(0===z.length||(z.clear(),!1))}markNodeToRemove(e){z.push(e)}removeMarkedNodes(){this._removeNodes(z,Scheduler/* noBudget */.G5,Y.pop)}_removeNodes(e,t,i){const s=e.length;if(0!==s&&!t.done){for((0,maybe/* isSome */.pC)(this._index)&&this._index.requestUpdate();e.length>0&&!t.done;){const s=e.pop(),a=this._index;i===Y.fadeout&&this.layerView.nodeFadeoutEnabled&&(0,maybe/* isSome */.pC)(a)&&a.isGeometryVisible(s)?this.layerView.fadeNode(s,I3SLayerView/* FadeDirection.FadeOut */.B.FadeOut,!0):this.layerView.removeNode(s),t.madeProgress()}if(this._loadedNodeScales.size>0)for(let t=e.length;t<s;t++){const i=e.data[t];this._loadedNodeScales.delete(i)}}}_needsUpdate(e){if(!e.resources.hasFeatureData||this._updatingNodes.has(e.index))return!1;const t=this.layerView.getLoadedAttributes(e.index);return null!=t&&t!==this._requiredAttributes}_updateLoadedNode(e){const t=new AbortController;this._updatingNodes.set(e.index,t);(X(this.layerView.getLoadedAttributes(e.index),this._requiredAttributes)?Promise.resolve(this.layerView.getAttributeData(e.index)):this._nodeLoader.loadAttributes(e,this._requiredAttributes,t.signal)).then((i=>this.schedule((()=>this.layerView.updateAttributes(e.index,{loadedAttributes:this._requiredAttributes,attributeData:i},t.signal)),t.signal))).catch((i=>{if(!(0,promiseUtils/* isAbortError */.D_)(i))return this.layerView.updateAttributes(e.index,{loadedAttributes:this._requiredAttributes,attributeData:{}},t.signal)})).catch((()=>{})).then((()=>{this._updatingNodes.delete(e.index),this._evaluateUpdating()})),this._evaluateUpdating()}_loadNode(e){if(this._loadingNodes.has(e.index))return void I3SOnDemandController_j.error("already loading node "+e.index);const t=new AbortController;this._loadingNodes.set(e.index,t),this._evaluateUpdating(),this._loadAndAddNode(e,t.signal).then((i=>{i&&(0,maybe/* isSome */.pC)(this._index)&&this._loadingNodes.get(e.index)===t&&(this._loadingNodes.delete(e.index),this._index.requestUpdate())})).catch((e=>{if(!(0,promiseUtils/* isAbortError */.D_)(e))throw e})).finally((()=>{this._loadingNodes.get(e.index)===t&&this._loadingNodes.delete(e.index),this._evaluateUpdating()}))}_loadAndAddNode(e,t){return e.cacheState===I3SNode/* CacheState.Uncached */.Hw.Uncached?this._loadUncached(e,t).then((()=>!1)):this._loadCached(e,t).then((t=>!t&&(e.cacheState=I3SNode/* CacheState.Uncached */.Hw.Uncached,!0))).catch((t=>!(0,promiseUtils/* isAbortError */.D_)(t)&&(e.cacheState=I3SNode/* CacheState.Uncached */.Hw.Uncached,!0)))}_enableFromGPUCache(e,t){if(this._disableMemCache||(0,maybe/* isNone */.Wi)(this._index))return!1;if(t===I3SNode/* NodeState.Hole */.FE.Hole&&!this._index.useNodeAsHole(e.index))return!0;const i=this._loadCachedGPUData(e);return!!i&&(this.layerView.addCachedGPUData(e,i,t),this._nodeAdded(),!0)}_loadCachedGPUData(e){const t=this.layerView.loadCachedGPUData(e);return (0,maybe/* isSome */.pC)(t)&&(0,maybe/* isSome */.pC)(t.attributeInfo)&&X(t.attributeInfo.loadedAttributes,this._requiredAttributes)?t:(this.layerView.deleteCachedGPUData(t),null)}_nodeAdded(){(0,maybe/* isSome */.pC)(this._index)&&this._index.requestUpdate(),this._lodHandling.setLodGlobalDirty(),this._evaluateUpdating()}_loadCached(e,t){if(this._enableFromGPUCache(e,I3SNode/* NodeState.Leaf */.FE.Leaf))return Promise.resolve(!0);const i=this.layerView;return!this.disableIDBCache&&i.loadCachedNodeData&&i.addCachedNodeData?this.schedule((()=>i.loadCachedNodeData(e,t,((t,i)=>this._nodeLoader.loadTextures(e,t,i)))),t).then((s=>{if((0,maybe/* isNone */.Wi)(s))return!1;const a=this._requiredAttributes;return this.reschedule((()=>this._nodeLoader.loadAttributes(e,a,t)),t).then((r=>this.reschedule((()=>i.addCachedNodeData(e,s,{loadedAttributes:a,attributeData:r},t)),t))).then((()=>(this._nodeAdded(),!0)))})):Promise.resolve(!1)}_loadUncached(e,t){return this._downloadingCount++,this._nodeLoader.loadNodeData(e,t).catch((e=>{throw this._downloadingCount--,e})).then((i=>(this._downloadingCount--,this.schedule((()=>this.layerView.addNode(e,i,t)),t)))).then((()=>{this._nodeAdded(),e.cacheState=I3SNode/* CacheState.Cached */.Hw.Cached})).catch((t=>{if(!(0,promiseUtils/* isAbortError */.D_)(t))throw I3SOnDemandController_j.error("#loadNodeData()",this.layer,`Failed to load node \'${e.id}\'`,t),e.failed=!0,(0,maybe/* isSome */.pC)(this._index)&&this._index.requestUpdate(),t}))}_updateIdleState(e){e!==this._isIdle&&(this._isIdle=e,this._evaluateUpdating(),e&&this._index&&(0,maybe/* isSome */.pC)(this._index)&&this._index.resetFailedNodes())}_getScale(e){if(this._loadedNodeScales.has(e.index))return this._loadedNodeScales.get(e.index);const t=this._computeScale(e);return this.layerView.isNodeLoaded(e.index)&&this._loadedNodeScales.set(e.index,t),t}_computeScale(e){this._tmpPoint.x=e.mbs[0],this._tmpPoint.y=e.mbs[1],this._tmpPoint.z=e.mbs[2];const t=e.mbs[3];return this.layerView.view.basemapTerrain.getSphereScale(this._tmpPoint,t)}_isNodeInScaleBounds(e){if(!this.areScaleBoundsActive)return!0;const t=this._getScale(e),{minScale:i,maxScale:s}=(0,layerViewUtils/* extractSafeScaleBounds */.lu)(this.layer);return (0,layerViewUtils/* scaleBoundsPredicate */.rs)(t,i,s)}updateStats(e){e.index=(0,maybe/* isSome */.pC)(this._index)?this._index.size:0,this.isGraphics3D&&(e.detail=this._featureLOD,e.target=this.featureTarget*this.baseLOD),(0,maybe/* isSome */.pC)(this._index)&&this._index.updateStats(e)}get test(){const e=this;return{index:this._index,set disableUpdates(t){e._updatesDisabled=t,t?e.cancelNodeLoading():e.requestUpdate()},set disableIDBCache(t){e.disableIDBCache=t},set ignoreServiceObb(t){(0,maybe/* isSome */.pC)(e._index)&&(e._index.ignoreServiceObb=t)},shouldLoadNode:t=>e._shouldLoadNode(t)}}notifyLODUpdate(){this._lodHandling.setLodGlobalDirty(),this._evaluateUpdating(),(0,maybe/* isSome */.pC)(this._index)&&this._index.requestUpdate()}geometryFilterChanged(e){const t=this._index;(0,maybe/* isSome */.pC)(t)&&t.layerFilterChanged(e),this.requestUpdate()}};(0,tslib_es6._)([(0,property/* property */.Cb)({readOnly:!0})],R.prototype,"isMeshPyramid",null),(0,tslib_es6._)([(0,property/* property */.Cb)({readOnly:!0})],R.prototype,"isGraphics3D",null),(0,tslib_es6._)([(0,property/* property */.Cb)({readOnly:!0})],R.prototype,"useMaximumNumberOfFeatures",null),(0,tslib_es6._)([(0,property/* property */.Cb)({readOnly:!0})],R.prototype,"indexStreamController",null),(0,tslib_es6._)([(0,property/* property */.Cb)({readOnly:!0})],R.prototype,"dataStreamController",null),(0,tslib_es6._)([(0,property/* property */.Cb)({readOnly:!0})],R.prototype,"crsVertex",null),(0,tslib_es6._)([(0,property/* property */.Cb)({readOnly:!0})],R.prototype,"crsIndex",null),(0,tslib_es6._)([(0,property/* property */.Cb)()],R.prototype,"screenSizeFactor",void 0),(0,tslib_es6._)([(0,property/* property */.Cb)()],R.prototype,"featureTarget",void 0),(0,tslib_es6._)([(0,property/* property */.Cb)()],R.prototype,"fixedFeatureTarget",void 0),(0,tslib_es6._)([(0,property/* property */.Cb)()],R.prototype,"layerView",void 0),(0,tslib_es6._)([(0,property/* property */.Cb)()],R.prototype,"layer",void 0),(0,tslib_es6._)([(0,property/* property */.Cb)({})],R.prototype,"updating",void 0),(0,tslib_es6._)([(0,property/* property */.Cb)({})],R.prototype,"updatingProgress",void 0),(0,tslib_es6._)([(0,property/* property */.Cb)({readOnly:!0})],R.prototype,"leavesReached",void 0),(0,tslib_es6._)([(0,property/* property */.Cb)({constructOnly:!0})],R.prototype,"scaleVisibilityEnabled",void 0),(0,tslib_es6._)([(0,property/* property */.Cb)({readOnly:!0,dependsOn:[]})],R.prototype,"rootNodeVisible",null),R=(0,tslib_es6._)([(0,subclass/* subclass */.j)("esri.layers.graphics.controllers.I3SOnDemandController")],R);const z=new PooledArray/* default */.Z({deallocator:null});let K;function X(e,t){return (0,maybe/* isSome */.pC)(e)&&e.length===t.length&&e.every((e=>$(t,e.name)>=0))}function $(e,t){const i=t.toLowerCase();for(let s=0;s<e.length;s++)if(e[s].name.toLowerCase()===i)return s;return-1}const J={factorIM:.2,factor3dObject:.05,distancePenalty:10},W=(0,aaBoundingRect/* create */.Ue)();var Y;!function(e){e[e.pop=0]="pop",e[e.fadeout=1]="fadeout"}(Y||(Y={}));const Z=R;\n\n\n//# sourceURL=webpack://reveal-js-testing/./node_modules/@arcgis/core/layers/graphics/controllers/I3SOnDemandController.js_+_6_modules?')},2774:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{eval('\n// EXPORTS\n__webpack_require__.d(__webpack_exports__, {\n  "l": () => (/* binding */ f)\n});\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/request.js\nvar request = __webpack_require__(66341);\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/core/arrayUtils.js\nvar arrayUtils = __webpack_require__(7753);\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/core/asyncUtils.js\nvar asyncUtils = __webpack_require__(67979);\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/core/byteSizeEstimations.js\nvar byteSizeEstimations = __webpack_require__(4745);\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/core/Logger.js\nvar Logger = __webpack_require__(13802);\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/core/maybe.js\nvar maybe = __webpack_require__(61681);\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/core/promiseUtils.js\nvar promiseUtils = __webpack_require__(78668);\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/intl/number.js\nvar number = __webpack_require__(25741);\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/rest/support/Query.js\nvar Query = __webpack_require__(14136);\n;// CONCATENATED MODULE: ./node_modules/@arcgis/core/layers/support/featureQueryAll.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nasync function featureQueryAll_t(r,t,o){t=t.clone(),r.capabilities.query.supportsMaxRecordCountFactor&&(t.maxRecordCountFactor=u(r));const i=featureQueryAll_a(r),n=r.capabilities.query.supportsPagination;t.start=0,t.num=i;let s=null;for(;;){const a=await r.source.queryFeaturesJSON(t,o);if((0,maybe/* isNone */.Wi)(s)?s=a:s.features=s.features.concat(a.features),s.exceededTransferLimit=a.exceededTransferLimit,!n||!a.exceededTransferLimit)break;t.start+=i}return s}function featureQueryAll_a(e){return u(e)*o(e)}function o(e){return e.capabilities.query.maxRecordCount||2e3}function u(e){return e.capabilities.query.supportsMaxRecordCountFactor?Query/* default.MAX_MAX_RECORD_COUNT_FACTOR */.Z.MAX_MAX_RECORD_COUNT_FACTOR:1}\n\n;// CONCATENATED MODULE: ./node_modules/@arcgis/core/views/3d/layers/i3s/I3SAttributeOverrides.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nconst p=Logger/* default.getLogger */.Z.getLogger("esri.views.3d.layers.i3s.I3SAttributeOverrides");class f{constructor(e,t){this.layer=e,this.warnMaximumChangedObjectsExceeded=!1,this.changedObjectIds=new Set,this.pendingFetchAbortController=new AbortController,this.interactiveEditingSessions=null,this._maximumNumberOfEditOVerrides=v,this.memCache=t.newCache(`${e.uid}-attribute-overrides`),this.pendingFetchChangedObjectIds=this._fetchChangedObjectIds(this.pendingFetchAbortController.signal),this.pendingFetchChangedObjectIds.then((()=>this.pendingFetchAbortController=null))}destroy(){this.layer=null,this.memCache.destroy(),this.memCache=null,this.pendingFetchAbortController&&(this.pendingFetchAbortController.abort(),this.pendingFetchAbortController=null),this.pendingFetchChangedObjectIds=null}createInteractiveEditSession(e){this.changedObjectIds.add(e),(0,maybe/* isNone */.Wi)(this.interactiveEditingSessions)&&(this.interactiveEditingSessions=[]);const t=this.interactiveEditingSessions,i=new y(e,{rollback:()=>{(0,arrayUtils/* remove */.Od)(t,i),0===t.length&&(this.interactiveEditingSessions=null)},commit:t=>{for(const[s,i]of t)this.updateValue(e,s,i)}});return t.unshift(i),i}async apply(e,t,s){if((0,maybe/* isNone */.Wi)(t))return;const{loadedAttributes:i,attributeData:r}=t;if((0,maybe/* isNone */.Wi)(i)||0===i.length||(0,maybe/* isNone */.Wi)(r))return;if(await (0,promiseUtils/* whenOrAbort */.Hl)(this.pendingFetchChangedObjectIds,s),0===this.changedObjectIds.size)return;const a={loadedAttributes:i,attributeData:r},n=this._getOverridesFromCache(e,a,this.changedObjectIds),{objectIds:o,fieldNames:d}=n,h=await this._queryOverridesFromAssociatedLayer(o,d,s);(0,maybe/* isNone */.Wi)(h)||this._processOverridesFromAssociatedLayer(e,h,d,a)}updateValue(e,t,s){this.changedObjectIds.add(e),this._cacheValue(e,t,s)}_cacheValue(e,t,s){this.memCache.put(this._getCacheKey(e,t),s,this._memCacheValueSize(s))}_getOverridesFromCache(e,{loadedAttributes:t,attributeData:s},i){const r=new Set,a=new Array;for(const o of t)a[o.index]=s[o.name];const n=new Set;for(let o=0;o<e.length;o++){const s=e[o];if(i.has(s))for(const e of t){const t=this._fromCache(s,e.index);void 0===t?(r.add(s),n.add(e.name)):a[e.index][o]=t}}return{objectIds:Array.from(r),fieldNames:Array.from(n)}}_fromCache(e,t){const s=this._fromInteractiveEditingSession(e,t);if(void 0!==s)return s;const i=this._getCacheKey(e,t);return this.memCache.get(i)}_fromInteractiveEditingSession(e,t){if(!(0,maybe/* isNone */.Wi)(this.interactiveEditingSessions))for(const s of this.interactiveEditingSessions){if(s.objectId!==e)continue;const i=s.get(t);if(void 0!==i)return i}}_getCacheKey(e,t){return`${e}-${t}`}async _queryOverridesFromAssociatedLayer(e,s,r){if(0===e.length||0===s.length)return null;e=e.sort(((e,t)=>e-t)),this.warnMaximumChangedObjectsExceeded&&(this.warnMaximumChangedObjectsExceeded=!1,this._logMaximumObjectsExceededWarning());const a=(0,maybe/* unwrap */.Wg)(this.layer.associatedLayer),n=a.createQuery();n.where="1=1",n.returnGeometry=!1,n.outFields=[a.objectIdField,...s],n.cacheHint=!0,n.objectIds=e;const o=featureQueryAll_a(a),c=e.length>o?(0,arrayUtils/* splitIntoChunks */.vr)(e,o).map((e=>{const t=n.clone();return t.objectIds=e,(0,asyncUtils/* resultOrAbort */.mt)(featureQueryAll_t(a,t,{signal:r}))})):[(0,asyncUtils/* resultOrAbort */.mt)(featureQueryAll_t(a,n,{signal:r}))];return(await Promise.all(c)).reduce(((e,t)=>e.concat(t.ok?t.value.features:[])),[])}_logMaximumObjectsExceededWarning(){let e=`The number of edited objects that are not yet cached in the scene service exceeds the maximum limit. Attribute changes will only be available for the first ${(0,number/* formatNumber */.uf)(this._maximumNumberOfEditOVerrides)} objects. Please consider re-caching the scene service`;const t=this.layer.portalItem;t&&t.loaded?e+=` (${t.portal.url}/home/item.html?id=${t.id}#settings)`:e+=` (${this.layer.parsedUrl.path})`,p.warn("#queryOverrides()",this.layer.title,`${e}.`)}_processOverridesFromAssociatedLayer(e,t,s,{loadedAttributes:i,attributeData:r}){const a=(0,maybe/* unwrap */.Wg)(this.layer.associatedLayer).objectIdField,n=s.map((e=>r[e])),o=new Map(i.map((e=>[e.name,e.index]))),c=s.map((e=>o.get(e))),h=new Map(Array.from(e,((e,t)=>[e,t])));for(const d of t){const e=d.attributes[a];for(let t=0;t<s.length;t++){const i=c[t],r=h.get(e),a=d.attributes[s[t]];n[t][r]=a,this._cacheValue(e,i,a)}}}_memCacheValueSize(e){return"string"==typeof e?(0,byteSizeEstimations/* estimateStringByteSize */.hH)(e):(0,byteSizeEstimations/* estimateNumberByteSize */.G3)()}async _fetchChangedObjectIds(t){var s,i,a;const n=this.layer;if(await n.load({signal:t}),this.changedObjectIds.clear(),(0,maybe/* isNone */.Wi)(n.associatedLayer)||null==(s=n.associatedLayer.capabilities)||null==(i=s.operations)||!i.supportsChangeTracking)return;const o=this._getFetchChangedObjectIdsServerGen();if((0,maybe/* isNone */.Wi)(o))return null;const d=n.associatedLayer.layerId,m=await (0,asyncUtils/* result */.q6)((0,request["default"])(`${n.associatedLayer.url}/extractChanges`,{method:"post",query:{f:"json",returnIdsOnly:!0,layers:`${d}`,returnUpdates:!0,returnDeletes:!1,returnInserts:!1,layerServerGens:JSON.stringify([{id:d,serverGen:o}])},timeout:C,signal:t})),u=m.ok&&null!=(a=m.value.data)&&a.edits?(0,maybe/* get */.U2)(m.value.data.edits[0],"objectIds","updates"):null;if((0,maybe/* isSome */.pC)(u)){const e=Math.min(this._maximumNumberOfEditOVerrides,u.length);e<u.length&&(this.warnMaximumChangedObjectsExceeded=!0);const t=u.sort(((e,t)=>e-t));for(let s=0;s<e;s++)this.changedObjectIds.add(t[s])}}_getFetchChangedObjectIdsServerGen(){const e=this.layer;if((0,maybe/* isSome */.pC)(e.serviceUpdateTimeStamp)&&(0,maybe/* isSome */.pC)(e.serviceUpdateTimeStamp.lastUpdate))return e.serviceUpdateTimeStamp.lastUpdate;const t=e.associatedLayer;return (0,maybe/* isSome */.pC)(t)&&(0,maybe/* isSome */.pC)(t.serverGens)&&(0,maybe/* isSome */.pC)(t.serverGens.minServerGen)?t.serverGens.minServerGen:null}get test(){const e=Array.from(this.changedObjectIds),t=this.pendingFetchChangedObjectIds,s=this;return{changedObjectIds:e,pendingFetchChangedObjectIds:t,get maximumNumberOfEditOVerrides(){return s._maximumNumberOfEditOVerrides},set maximumNumberOfEditOVerrides(e){s._maximumNumberOfEditOVerrides=e}}}}class y{constructor(e,t){this.objectId=e,this.options=t,this.updates=new Map,this.state=O.ACTIVE}get(e){return this.updates.get(e)}set(e,t){this.isActive&&this.updates.set(e,t)}rollback(){this.isActive&&(this.state=O.ROLLED_BACK,this.options.rollback())}commit(){this.isActive&&(this.state=O.COMMITTED,this.options.commit(this.updates),this.updates.clear())}get isActive(){return this.state===O.ACTIVE}}var O;!function(e){e[e.ACTIVE=0]="ACTIVE",e[e.COMMITTED=1]="COMMITTED",e[e.ROLLED_BACK=2]="ROLLED_BACK"}(O||(O={}));const C=1e4,v=5e4;\n\n\n//# sourceURL=webpack://reveal-js-testing/./node_modules/@arcgis/core/views/3d/layers/i3s/I3SAttributeOverrides.js_+_1_modules?')},66478:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{eval('\n// EXPORTS\n__webpack_require__.d(__webpack_exports__, {\n  "RE": () => (/* binding */ S),\n  "cU": () => (/* binding */ C),\n  "dY": () => (/* binding */ F),\n  "R0": () => (/* binding */ h),\n  "Pg": () => (/* binding */ b),\n  "K0": () => (/* binding */ D),\n  "nn": () => (/* binding */ w)\n});\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/core/has.js\nvar has = __webpack_require__(39994);\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/core/mathUtils.js\nvar mathUtils = __webpack_require__(19431);\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/core/maybe.js\nvar maybe = __webpack_require__(61681);\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/views/3d/layers/i3s/enums.js\nvar enums = __webpack_require__(42114);\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/core/promiseUtils.js\nvar promiseUtils = __webpack_require__(78668);\n;// CONCATENATED MODULE: ./node_modules/@arcgis/core/views/3d/webgl-engine/core/material/RenderTexture.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nclass RenderTexture_i{constructor(t,i){this._textureRep=t,this._disposed=!1;const r=this._textureRep.acquire(i);(0,promiseUtils/* isPromiseLike */.y8)(r)?(r.then((t=>{this._disposed?(0,maybe/* releaseMaybe */.RY)(t):this._textureRef=t})),this.loadPromise=r):this._textureRef=r}dispose(){this._textureRef=(0,maybe/* releaseMaybe */.RY)(this._textureRef),this._disposed=!0}bind(e,s,i){const r=(0,maybe/* isSome */.pC)(this._textureRef)?this._textureRef.glTexture:null;(0,maybe/* isSome */.pC)(r)&&(e.bindTexture(r,s),e.setUniform2f(i,r.descriptor.width,r.descriptor.height))}}\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl.js\nvar PhysicallyBasedRenderingParameters_glsl = __webpack_require__(3864);\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl.js\nvar AlphaDiscard_glsl = __webpack_require__(41272);\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/util/EllipsoidMode.js\nvar EllipsoidMode = __webpack_require__(94283);\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/views/3d/webgl-engine/lib/basicInterfaces.js\nvar basicInterfaces = __webpack_require__(70984);\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/views/3d/webgl-engine/lib/Texture.js + 1 modules\nvar Texture = __webpack_require__(44101);\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/views/webgl/enums.js\nvar webgl_enums = __webpack_require__(91907);\n;// CONCATENATED MODULE: ./node_modules/@arcgis/core/views/3d/layers/i3s/I3SMaterialUtil.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nfunction h(e,a){const o=new Map,t=(e,a)=>{if((0,maybe/* isNone */.Wi)(e))return-1;if(o.has(e.id)){const r=o.get(e.id);return r.usage|=a,r.id}const r=o.size;return o.set(e.id,{id:r,usage:a}),r},l=a.pbrMetallicRoughness,c=l&&l.baseColorFactor,u=a.emissiveFactor,d=null==a.normalTexture&&null==a.emissiveTexture&&null==a.occlusionTexture&&(!l||null==l.metallicRoughnessTexture&&1===l.roughnessFactor&&(1===l.metallicFactor||0===l.metallicFactor)),g=d?PhysicallyBasedRenderingParameters_glsl/* PBRSchematicMRRValues.0 */.Fw[0]:l?l.metallicFactor:1,p=d?PhysicallyBasedRenderingParameters_glsl/* PBRSchematicMRRValues.1 */.Fw[1]:l?l.roughnessFactor:1,h="mask"===a.alphaMode?enums/* TextureUsage.Color */.v.Color|enums/* TextureUsage.AlphaMask */.v.AlphaMask:enums/* TextureUsage.Color */.v.Color,x={baseColorFactor:c?[c[0],c[1],c[2],c[3]]:[1,1,1,1],baseColorTextureId:t(l&&l.baseColorTexture,h),metallicRoughnessTextureId:t(l&&l.metallicRoughnessTexture,enums/* TextureUsage.MetallicRoughness */.v.MetallicRoughness),metallicFactor:g,roughnessFactor:p},b={alphaMode:a.alphaMode,alphaCutoff:a.alphaCutoff,doubleSided:a.doubleSided,cullFace:"none"===a.cullFace?basicInterfaces/* CullFaceOptions.None */.Vr.None:"back"===a.cullFace?basicInterfaces/* CullFaceOptions.Back */.Vr.Back:"front"===a.cullFace?basicInterfaces/* CullFaceOptions.Front */.Vr.Front:void 0,normalTextureId:t(a.normalTexture,enums/* TextureUsage.Normal */.v.Normal),emissiveTextureId:t(a.emissiveTexture,enums/* TextureUsage.Emissive */.v.Emissive),occlusionTextureId:t(a.occlusionTexture,enums/* TextureUsage.Occlusion */.v.Occlusion),emissiveFactor:u?[u[0],u[1],u[2]]:[0,0,0],metallicRoughness:x,wrapTextures:!1,hasParametersFromSource:d},F=[];return o.forEach((({usage:a},o)=>{const s=(0,maybe/* isSome */.pC)(e)&&e[o]&&e[o].formats,t=s?f(s.map((({name:e,format:a})=>({name:e,encoding:T[a]})))):[];F.push({id:o,usage:a,encodings:t})})),{material:b,textures:F}}function f(e){return e.sort(((e,a)=>e.encoding-a.encoding))}const T={ktx2:enums/* TextureEncoding.KTX2 */.j.KTX2,basis:enums/* TextureEncoding.Basis */.j.Basis,dds:enums/* TextureEncoding.DDS_S3TC */.j.DDS_S3TC,png:enums/* TextureEncoding.PNG */.j.PNG,jpg:enums/* TextureEncoding.JPG */.j.JPG,"ktx-etc2":enums/* TextureEncoding.KTX_ETC2 */.j.KTX_ETC2},x={[Texture/* Texture.KTX2_ENCODING */.x.KTX2_ENCODING]:enums/* TextureEncoding.Basis */.j.Basis,[Texture/* Texture.BASIS_ENCODING */.x.BASIS_ENCODING]:enums/* TextureEncoding.Basis */.j.Basis,[Texture/* Texture.DDS_ENCODING */.x.DDS_ENCODING]:enums/* TextureEncoding.DDS_S3TC */.j.DDS_S3TC,"image/png":enums/* TextureEncoding.PNG */.j.PNG,"image/jpg":enums/* TextureEncoding.JPG */.j.JPG,"image/jpeg":enums/* TextureEncoding.JPG */.j.JPG,"image/ktx":enums/* TextureEncoding.KTX_ETC2 */.j.KTX_ETC2};function b(e){const o=e&&e.materialDefinitions?Object.keys(e.materialDefinitions)[0]:null,r=e&&e.textureDefinitions?Object.keys(e.textureDefinitions)[0]:null,s=o&&e.materialDefinitions[o],t=r&&e.textureDefinitions[r],l=F();if(null!=s){const e=s.params;e.diffuse&&(l.metallicRoughness.baseColorFactor=[e.diffuse[0],e.diffuse[1],e.diffuse[2],1]),null!=e.doubleSided&&(l.doubleSided=e.doubleSided,l.cullFace=e.doubleSided?basicInterfaces/* CullFaceOptions.None */.Vr.None:basicInterfaces/* CullFaceOptions.Back */.Vr.Back),"none"!==e.cullFace&&"front"!==e.cullFace&&"back"!==e.cullFace||(l.cullFace="none"===e.cullFace?basicInterfaces/* CullFaceOptions.None */.Vr.None:"back"===e.cullFace?basicInterfaces/* CullFaceOptions.Back */.Vr.Back:basicInterfaces/* CullFaceOptions.Front */.Vr.Front),e.transparency&&(l.metallicRoughness.baseColorFactor[3]=(0,mathUtils/* clamp */.uZ)(1-e.transparency,0,1)),(e.useVertexColorAlpha||l.metallicRoughness.baseColorFactor[3]<1)&&(l.alphaMode="blend")}const i=[];if(null!=t){const e=0;!t.wrap||"repeat"!==t.wrap[0]&&"repeat"!==t.wrap[1]||(l.wrapTextures=!0);let a=enums/* TextureUsage.Color */.v.Color;"rgba"===t.channels&&(l.alphaMode="blend",a|=enums/* TextureUsage.AlphaMask */.v.AlphaMask);const o=t.images.length-1,r=t.images[o],s=e=>e&&e.split("/").pop(),c=Array.isArray(t.encoding)?f(t.encoding.map(((e,a)=>({name:s(r.href[a]),encoding:x[e]||0})))):[{name:s(r.href),encoding:x[t.encoding]||0}];i.push({id:e,usage:a,encodings:c}),l.metallicRoughness.baseColorTextureId=e}return{material:l,textures:i}}const F=()=>({alphaMode:"opaque",alphaCutoff:AlphaDiscard_glsl/* defaultMaskAlphaCutoff */.F,doubleSided:!0,cullFace:basicInterfaces/* CullFaceOptions.None */.Vr.None,normalTextureId:-1,emissiveTextureId:-1,occlusionTextureId:-1,emissiveFactor:[0,0,0],metallicRoughness:{baseColorFactor:[.8,.8,.8,1],baseColorTextureId:-1,metallicRoughnessTextureId:-1,metallicFactor:0,roughnessFactor:.6},wrapTextures:!1,hasParametersFromSource:!0});function C(e,a,r,t){if((0,maybe/* isNone */.Wi)(e)||null==e.data)return null;const l=e.data,i=!(l instanceof HTMLImageElement)||(0,mathUtils/* isPowerOfTwo */.wt)(l.width)&&(0,mathUtils/* isPowerOfTwo */.wt)(l.height),c=t.renderingContext.parameters.maxMaxAnisotropy,u=r&&!t.capabilities.shaderTextureLOD?1:c,m=i&&!e.downsampled&&u>1,d=r||!a.wrapTextures?P:M,p=E(e.encoding),h=e.usage&enums/* TextureUsage.Color */.v.Color?"opaque"===a.alphaMode?3:4:3;return new Texture/* Texture */.x(l,{mipmap:m,maxAnisotropy:u,encoding:p,wrap:d,components:h,noUnpackFlip:!0})}const P={s:webgl_enums/* TextureWrapMode.CLAMP_TO_EDGE */.e8.CLAMP_TO_EDGE,t:webgl_enums/* TextureWrapMode.CLAMP_TO_EDGE */.e8.CLAMP_TO_EDGE},M={s:webgl_enums/* TextureWrapMode.REPEAT */.e8.REPEAT,t:webgl_enums/* TextureWrapMode.REPEAT */.e8.REPEAT};function S(e,o,s,t,i,m){const g=m.rendererTextureUsage,p=e=>R(t,s,e&g),h=o.metallicRoughness.baseColorFactor,f=(0,mathUtils/* clamp */.uZ)(o.metallicRoughness.baseColorFactor[3],0,1);e.baseColor=[h[0],h[1],h[2],f],e.hasParametersFromSource=!!o.hasParametersFromSource,e.usePBR=m.usePBR,e.mrrFactors=[o.metallicRoughness.metallicFactor,o.metallicRoughness.roughnessFactor,o.hasParametersFromSource?.2:.5],e.emissiveFactor=o.emissiveFactor,e.isIntegratedMesh=m.isIntegratedMesh,e.alphaCutoff="mask"===o.alphaMode?o.alphaCutoff:AlphaDiscard_glsl/* defaultMaskAlphaCutoff */.F,e.alphaDiscardMode="opaque"===o.alphaMode?basicInterfaces/* AlphaDiscardMode.Opaque */.JJ.Opaque:"mask"===o.alphaMode?basicInterfaces/* AlphaDiscardMode.Mask */.JJ.Mask:basicInterfaces/* AlphaDiscardMode.MaskBlend */.JJ.MaskBlend;const T=[],x=p(enums/* TextureUsage.Color */.v.Color|enums/* TextureUsage.AlphaMask */.v.AlphaMask);(0,maybe/* isSome */.pC)(x)&&(e.baseColorTexture=new RenderTexture_i(i,x),T.push(e.baseColorTexture.loadPromise));const b=p(enums/* TextureUsage.MetallicRoughness */.v.MetallicRoughness);(0,maybe/* isSome */.pC)(b)&&(e.metallicRoughnessTexture=new RenderTexture_i(i,b),T.push(e.metallicRoughnessTexture.loadPromise));const F=p(enums/* TextureUsage.Emissive */.v.Emissive);(0,maybe/* isSome */.pC)(F)&&(e.emissionTexture=new RenderTexture_i(i,F),T.push(e.emissionTexture.loadPromise));const C=p(enums/* TextureUsage.Occlusion */.v.Occlusion);(0,maybe/* isSome */.pC)(C)&&(e.occlusionTexture=new RenderTexture_i(i,C),T.push(e.occlusionTexture.loadPromise));const P=p(enums/* TextureUsage.Normal */.v.Normal);return (0,maybe/* isSome */.pC)(P)&&(e.normalTexture=new RenderTexture_i(i,P),T.push(e.normalTexture.loadPromise)),e.commonMaterialParameters.slicePlaneEnabled=m.slicePlaneEnabled,e.commonMaterialParameters.doubleSided=o.doubleSided,e.commonMaterialParameters.cullFace=o.cullFace,e.ellipsoidMode=(0,EllipsoidMode/* getEllipsoidMode */.j)(m.viewSpatialReference),Promise.all(T)}function D(a){const o=!!a.compressedTextureS3TC,r=!!a.compressedTextureETC,s=(0,has/* default */.Z)("disable-feature:i3s-basis")?0:enums/* TextureEncoding.Basis */.j.Basis|enums/* TextureEncoding.KTX2 */.j.KTX2,n=enums/* TextureEncoding.JPG */.j.JPG|enums/* TextureEncoding.PNG */.j.PNG,l=s|enums/* TextureEncoding.DDS_S3TC */.j.DDS_S3TC;return n|(o?l:0)|(r?s:0)}function w(e,a){return e.find((e=>0!=(e.encoding&a)))}function R(e,a,o){if((0,maybe/* isNone */.Wi)(e)||o===enums/* TextureUsage.None */.v.None)return null;for(let s=0;s<e.length;s++){const t=e[s];if((0,maybe/* isSome */.pC)(t)&&0!=(t.usage&o)){const e=a[s];return (0,maybe/* isSome */.pC)(e)?e.id:null}}return null}function E(e){switch(e){case enums/* TextureEncoding.KTX2 */.j.KTX2:return Texture/* Texture.KTX2_ENCODING */.x.KTX2_ENCODING;case enums/* TextureEncoding.Basis */.j.Basis:return Texture/* Texture.BASIS_ENCODING */.x.BASIS_ENCODING;case enums/* TextureEncoding.DDS_S3TC */.j.DDS_S3TC:return Texture/* Texture.DDS_ENCODING */.x.DDS_ENCODING;case enums/* TextureEncoding.PNG */.j.PNG:return"image/png";case enums/* TextureEncoding.JPG */.j.JPG:return"image/jpeg";case enums/* TextureEncoding.KTX_ETC2 */.j.KTX_ETC2:return"image/ktx";default:return""}}\n\n\n//# sourceURL=webpack://reveal-js-testing/./node_modules/@arcgis/core/views/3d/layers/i3s/I3SMaterialUtil.js_+_1_modules?')},79946:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{eval('/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   "$i": () => (/* binding */ t),\n/* harmony export */   "FE": () => (/* binding */ a),\n/* harmony export */   "Hw": () => (/* binding */ o),\n/* harmony export */   "NB": () => (/* binding */ c),\n/* harmony export */   "O4": () => (/* binding */ n),\n/* harmony export */   "U_": () => (/* binding */ i),\n/* harmony export */   "oQ": () => (/* binding */ d),\n/* harmony export */   "w5": () => (/* binding */ s)\n/* harmony export */ });\n/* harmony import */ var _chunks_vec4f64_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(1983);\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nclass t{constructor(t,i){this.id=t,this.mbs=i,this.renderMbs=(0,_chunks_vec4f64_js__WEBPACK_IMPORTED_MODULE_0__.d)([0,0,0,-1]),this.imModificationImpact=n.NotChecked}}var i,n,o,s,a;!function(e){e[e.Unmodified=0]="Unmodified",e[e.Culled=1]="Culled",e[e.NotChecked=2]="NotChecked"}(i||(i={})),function(e){e[e.Unmodified=0]="Unmodified",e[e.PotentiallyModified=1]="PotentiallyModified",e[e.Culled=2]="Culled",e[e.Unknown=3]="Unknown",e[e.NotChecked=4]="NotChecked"}(n||(n={}));class c extends t{constructor(e,t,i,n,s,a,c,d,h,r){super(e,i),this.index=t,this.childCount=n,this.level=s,this.resources=a,this.version=c,this.lodMetric=d,this.maxError=h,this.numFeatures=r,this.failed=!1,this.hasModifications=!1,this.cacheState=o.Unknown,this.vertexCount=0,this.memory=0}}!function(e){e[e.Unknown=0]="Unknown",e[e.Uncached=1]="Uncached",e[e.Cached=2]="Cached"}(o||(o={})),function(e){e[e.None=0]="None",e[e.MaxScreenThreshold=1]="MaxScreenThreshold",e[e.ScreenSpaceRelative=2]="ScreenSpaceRelative",e[e.RemovedFeatureDiameter=3]="RemovedFeatureDiameter",e[e.DistanceRangeFromDefaultCamera=4]="DistanceRangeFromDefaultCamera"}(s||(s={})),function(e){e[e.Hole=0]="Hole",e[e.Leaf=1]="Leaf"}(a||(a={}));class d{constructor(e,t,i,n){this.nodeHasLOD=e,this.isChosen=t,this.lodLevel=i,this.version=n}}\n\n\n//# sourceURL=webpack://reveal-js-testing/./node_modules/@arcgis/core/views/3d/layers/i3s/I3SNode.js?')},42114:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{eval('/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   "j": () => (/* binding */ e),\n/* harmony export */   "v": () => (/* binding */ s)\n/* harmony export */ });\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nvar e,s;!function(e){e[e.KTX2=1]="KTX2",e[e.Basis=2]="Basis",e[e.DDS_S3TC=4]="DDS_S3TC",e[e.PNG=8]="PNG",e[e.JPG=16]="JPG",e[e.KTX_ETC2=32]="KTX_ETC2"}(e||(e={})),function(e){e[e.None=0]="None",e[e.Color=1]="Color",e[e.MetallicRoughness=2]="MetallicRoughness",e[e.Normal=4]="Normal",e[e.Occlusion=8]="Occlusion",e[e.Emissive=16]="Emissive",e[e.AlphaMask=32]="AlphaMask",e[e.ColorTextures=19]="ColorTextures",e[e.GeometryTextures=36]="GeometryTextures",e[e.GeometryTexturesPBR=44]="GeometryTexturesPBR",e[e.AllTextures=37]="AllTextures",e[e.AllTexturesPBR=63]="AllTexturesPBR"}(s||(s={}));\n\n\n//# sourceURL=webpack://reveal-js-testing/./node_modules/@arcgis/core/views/3d/layers/i3s/enums.js?')},73847:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{eval('/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   "B": () => (/* binding */ a)\n/* harmony export */ });\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nvar a;!function(a){a[a.FadeIn=0]="FadeIn",a[a.FadeOut=1]="FadeOut"}(a||(a={}));\n\n\n//# sourceURL=webpack://reveal-js-testing/./node_modules/@arcgis/core/views/3d/layers/support/I3SLayerView.js?')},63862:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{eval('/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   "f": () => (/* binding */ s)\n/* harmony export */ });\n/* harmony import */ var _core_Evented_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(31355);\n/* harmony import */ var _core_MapUtils_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(86114);\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nclass s extends _core_Evented_js__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .Z{constructor(){super(...arguments),this._map=new Map}clear(){if(this._map.size>0){const e=this.toArray();this._map.clear(),this.emit("change",{added:[],removed:e})}}get length(){return this._map.size}get(e){return this._map.get(e)}addMany(e){if(0===e.length)return;const t=new Set;for(let r=0;r<e.length;r++){const s=e[r],o=s.objectId,n=this._map.get(o);n?(t.add(o),s!==n&&(e[r]=n),++n.refCount):(s.refCount=1,this._map.set(o,s))}const s=t.size>0?e.filter((e=>!t.has(e.objectId))):e;s.length>0&&this.emit("change",{added:s,removed:[]})}removeMany(e){const t=[];for(const s of e){const e=s.objectId,r=this._map.get(e);null!=r&&--r.refCount<=0&&(this._map.delete(e),t.push(s))}t.length>0&&this.emit("change",{added:[],removed:t})}removeManyByObjectId(e){const t=[];for(const s of e){const e=this._map.get(s);null!=e&&--e.refCount<=0&&(this._map.delete(s),t.push(e))}t.length>0&&this.emit("change",{added:[],removed:t})}toArray(){return[...this._map.values()]}find(e){let s;return (0,_core_MapUtils_js__WEBPACK_IMPORTED_MODULE_1__/* .someMap */ .oE)(this._map,(t=>!!e(t)&&(s=t,!0))),s}forEach(e){this._map.forEach((t=>e(t)))}}\n\n\n//# sourceURL=webpack://reveal-js-testing/./node_modules/@arcgis/core/views/3d/support/GraphicsMap.js?')}}]);